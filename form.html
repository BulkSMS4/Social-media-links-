<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dynamic Form</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f8;padding:18px}
.wrap{max-width:800px;margin:auto;background:#fff;padding:18px;border-radius:10px;position:relative;}
input,textarea,select,button{width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box}
textarea{min-height:70px}
.draggableBtn{position:absolute;cursor:pointer;color:#fff;border:none;border-radius:8px}
.embedLink{margin-top:6px;padding:6px;background:#e8f0fe;border-radius:6px}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="wrap" id="formWrap"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
  authDomain: "usahackersland.firebaseapp.com",
  projectId: "usahackersland"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function getQueryParam(name) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(name);
}

function renderForm(data){
  const wrap = document.getElementById("formWrap");
  wrap.innerHTML = "";
  wrap.style.background = data.bgColor || "#fff";
  if(data.bgImageURL){
    wrap.style.backgroundImage = `url(${data.bgImageURL})`;
    wrap.style.backgroundSize = data.bgSize || "cover";
  }

  // Header Images
  if(data.avatarURL){
    const img = document.createElement("img");
    img.src = data.avatarURL;
    img.style.width = "90px";
    img.style.borderRadius = "50%";
    img.style.display = "block";
    img.style.margin = "auto";
    wrap.appendChild(img);
  }
  if(data.logoURL){
    const img = document.createElement("img");
    img.src = data.logoURL;
    img.style.width = "140px";
    img.style.display = "block";
    img.style.margin = "auto";
    wrap.appendChild(img);
  }

  // Titles and description
  const title = document.createElement("h2");
  title.style.textAlign = "center";
  title.style.color = data.titleColor || "#111";
  title.textContent = data.title || "";
  wrap.appendChild(title);

  const subtitle = document.createElement("p");
  subtitle.style.textAlign = "center";
  subtitle.style.color = data.subtitleColor || "#555";
  subtitle.textContent = data.subtitle || "";
  wrap.appendChild(subtitle);

  const desc = document.createElement("p");
  desc.textContent = data.description || "";
  wrap.appendChild(desc);

  // Warning
  if(data.enableWarning && data.warningPosition !== "none"){
    const warn = document.createElement("p");
    warn.style.color = "#b71c1c";
    warn.style.textAlign = data.warningPosition || "center";
    warn.textContent = data.warning || "";
    wrap.appendChild(warn);
  }

  // Form Inputs
  const formDiv = document.createElement("div");
  formDiv.style.display = "flex";
  formDiv.style.flexDirection = "column";
  formDiv.style.alignItems = data.btnPosition === "left" ? "flex-start" : data.btnPosition === "right" ? "flex-end" : "center";
  formDiv.style.gap = "8px";

  if(data.addAuth){
    const inputUser = document.createElement("input");
    inputUser.placeholder = data.usernamePlaceholder || "Username";
    formDiv.appendChild(inputUser);

    const inputPass = document.createElement("input");
    inputPass.type = "password";
    inputPass.placeholder = data.passwordPlaceholder || "Password";
    formDiv.appendChild(inputPass);
  }

  if(data.extraFields && data.extraFields.length){
    data.extraFields.forEach(v=>{
      if(v.trim()){
        const input = document.createElement("input");
        input.placeholder = v.trim();
        formDiv.appendChild(input);
      }
    });
  }

  // Embed Links
  if(data.embedLinks){
    data.embedLinks.forEach(link=>{
      if(!link.show) return;
      const div = document.createElement("div");
      div.className = "embedLink";
      const strong = document.createElement("strong");
      strong.textContent = link.text;
      div.appendChild(strong);
      const a = document.createElement("a");
      a.href = link.url;
      a.target = "_blank";
      a.textContent = " " + link.url;
      div.appendChild(a);
      if(link.desc){
        const small = document.createElement("small");
        small.textContent = " " + link.desc;
        div.appendChild(document.createElement("br"));
        div.appendChild(small);
      }
      formDiv.appendChild(div);
    });
  }

  // Generate Button
  if(data.showGenerateBtn){
    const genBtn = document.createElement("button");
    genBtn.textContent = data.generateBtnText || "Generate";
    genBtn.style.background = "#1976d2";
    genBtn.style.color = "#fff";
    genBtn.style.padding = "10px";
    genBtn.style.border = "none";
    genBtn.style.borderRadius = "8px";
    genBtn.onclick = ()=>alert("Form Generated!");
    formDiv.appendChild(genBtn);
  }

  // Main Button
  if(data.showMainBtn){
    const mainBtn = document.createElement("button");
    mainBtn.textContent = data.buttonText || "Submit";
    mainBtn.style.background = data.btnColor || "#1976d2";
    mainBtn.style.color = "#fff";
    mainBtn.style.padding = "10px";
    mainBtn.style.border = "none";
    mainBtn.style.borderRadius = "8px";
    mainBtn.onclick = (e)=>{
      e.preventDefault();
      alert("Form submitted!");
      if(data.enableRedirect && data.redirectURL){
        window.location.href = data.redirectURL;
      }
    };
    formDiv.appendChild(mainBtn);
  }

  wrap.appendChild(formDiv);

  // Extra draggable buttons
  if(data.extraButtons){
    data.extraButtons.forEach(b=>{
      if(!b.show) return;
      const btn = document.createElement("button");
      btn.className = "draggableBtn";
      btn.textContent = b.text;
      btn.style.background = b.color;
      btn.style.width = b.size + "px";
      btn.style.height = b.size + "px";
      btn.style.left = b.x + "%";
      btn.style.top = b.y + "%";
      btn.style.position = "absolute";
      btn.onclick = ()=>window.open(b.link,"_blank");
      wrap.appendChild(btn);
    });
  }

  // Footer
  const footer = document.createElement("footer");
  footer.style.textAlign = "center";
  footer.style.marginTop = "10px";
  footer.style.fontSize = "12px";
  footer.textContent = data.footerText || "";
  wrap.appendChild(footer);
}

const formId = getQueryParam("id");
if(formId){
  db.collection("forms").doc(formId).get().then(doc=>{
    if(doc.exists){
      renderForm(doc.data());
    } else {
      document.getElementById("formWrap").textContent = "Form not found!";
    }
  }).catch(err=>{
    console.error(err);
    document.getElementById("formWrap").textContent = "Error loading form.";
  });
} else {
  document.getElementById("formWrap").textContent = "No form ID provided.";
}
</script>
</body>
</html>
