<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Saved Links</title>

  <style>
    body { font-family: Arial; padding: 20px; background: #f2f2f2; }
    h2 { text-align: center; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }
    th { background: #e7e7e7; }

    button {
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      border: none;
    }
    .copy-btn { background: #007bff; color: white; }
    .delete-btn { background: red; color: white; }
    .small-btn { padding: 4px 8px; font-size: 12px; }
  </style>
</head>
<body>

  <h2>üîó Saved Form Links üîó</h2>

  <div style="margin-bottom: 12px;">
    <button onclick="copySelected()" class="copy-btn">üìã Copy Selected</button>
    <button onclick="deleteSelected()" class="delete-btn">üóë Delete Selected ‚Ü©Ô∏è</button>
  </div>

  <table>
    <thead>
      <tr>
        <th><input type="checkbox" id="selectAll"></th>
        <th>Form Link</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="linksTable"></tbody>
  </table>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    /* FIREBASE CONFIG ‚Äî SAME AS BUILDER */
    const firebaseConfig = {
      apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
      authDomain: "usahackersland.firebaseapp.com",
      projectId: "usahackersland",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const table = document.getElementById("linksTable");
    const selectAll = document.getElementById("selectAll");

    selectAll.addEventListener("change", () => {
      document.querySelectorAll(".row-select")
        .forEach(cb => cb.checked = selectAll.checked);
    });

    /* LOAD LINKS ‚Äî MATCHES /f/{id} */
    function loadLinks() {
      db.collection("forms")
        .orderBy("createdAt", "desc")
        .get()
        .then(snapshot => {
          table.innerHTML = "";

          snapshot.forEach(doc => {
            const id = doc.id;

            // ‚úÖ CORRECT PUBLIC LINK
            const link = `${location.origin}/f/${id}`;

            const row = document.createElement("tr");
            row.innerHTML = `
              <td>
                <input type="checkbox"
                  class="row-select"
                  data-id="${id}"
                  data-link="${link}">
              </td>
              <td>
                <a href="${link}" target="_blank">${link}</a>
              </td>
              <td>
                <button class="copy-btn small-btn"
                  onclick="copyLink('${link}')">Copy</button>
                <button class="delete-btn small-btn"
                  onclick="deleteSingle('${id}', this)">Delete</button>
              </td>
            `;

            table.appendChild(row);
          });
        });
    }

    function copyLink(link) {
      navigator.clipboard.writeText(link);
      alert("Copied!");
    }

    function deleteSingle(id, btn) {
      if (!confirm("Delete this form?")) return;
      db.collection("forms").doc(id).delete().then(() => {
        btn.closest("tr").remove();
      });
    }

    function copySelected() {
      const selected = [...document.querySelectorAll(".row-select:checked")]
        .map(cb => cb.dataset.link);

      if (!selected.length) return alert("No links selected.");
      navigator.clipboard.writeText(selected.join("\n"))
        .then(() => alert("Copied!"));
    }

    function deleteSelected() {
      const selected = [...document.querySelectorAll(".row-select:checked")];
      if (!selected.length) return alert("No forms selected.");
      if (!confirm("Delete selected forms?")) return;

      selected.forEach(cb => {
        db.collection("forms").doc(cb.dataset.id).delete();
        cb.closest("tr").remove();
      });

      alert("Deleted selected forms.");
    }

    loadLinks();
  </script>
</body>
</html>
