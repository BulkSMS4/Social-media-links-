<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Saved Links</title>
  <style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; }
    table { width: 100%; background: white; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    th { background: #eee; }
    a { color: blue; text-decoration: none; }
    a:hover { text-decoration: underline; }

    .actions { margin: 10px 0; }
    .actions button {
      padding: 8px 12px;
      margin-right: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .actions button:hover { opacity: 0.85; }
    .delete-btn { background: red; color: white; }
    .copy-btn { background: #007bff; color: white; }
    .small-btn { font-size: 12px; padding: 4px 8px; }
  </style>
</head>
<body>

  <h2>ðŸ”— Saved Links</h2>

  <div class="actions">
    <button onclick="copySelected()" class="copy-btn">ðŸ“‹ Copy Selected Links</button>
    <button onclick="deleteSelected()" class="delete-btn">ðŸ—‘ Delete Selected</button>
  </div>

  <table>
    <thead>
      <tr>
        <th><input type="checkbox" id="selectAll"></th>
        <th>Form Link</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="linksTable"></tbody>
  </table>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
      authDomain: "usahackersland.firebaseapp.com",
      projectId: "usahackersland"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const table = document.getElementById("linksTable");
    const selectAll = document.getElementById("selectAll");

    // SELECT ALL CHECKBOX
    selectAll.addEventListener("change", () => {
      document.querySelectorAll(".rowCheckbox").forEach(cb => cb.checked = selectAll.checked);
    });

    // ðŸ”¥ LOAD ALL LINKS
    function loadLinks() {
      db.collection("forms")
        .orderBy("createdAt", "desc")
        .get()
        .then(snapshot => {
          table.innerHTML = "";

          snapshot.forEach(doc => {
            const id = doc.id;

            // âœ… Correct working sharable link
            const link = `${location.origin}/Social-media-links-/form.html?id=${id}`;

            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td><input type="checkbox" class="rowCheckbox" data-id="${id}" data-link="${link}"></td>
              <td><a href="${link}" target="_blank">${link}</a></td>
              <td>
                <button class="copy-btn small-btn" onclick="copyLink('${link}')">ðŸ“‹ Copy</button>
                <button class="delete-btn small-btn" onclick="deleteForm('${id}', this)">ðŸ—‘ Delete</button>
              </td>
            `;
            table.appendChild(tr);
          });
        });
    }

    // ðŸ“‹ COPY SINGLE LINK
    function copyLink(link) {
      navigator.clipboard.writeText(link).then(() => {
        alert("âœ… Link copied!");
      });
    }

    // ðŸ—‘ DELETE SINGLE FORM
    function deleteForm(id, btn) {
      if (!confirm("Delete this form?")) return;

      db.collection("forms").doc(id).delete().then(() => {
        btn.closest("tr").remove();
      });
    }

    // ðŸ“‹ BULK COPY
    function copySelected() {
      const selected = [...document.querySelectorAll(".rowCheckbox:checked")]
        .map(cb => cb.dataset.link);

      if (selected.length === 0) return alert("No links selected.");

      navigator.clipboard.writeText(selected.join("\n"))
        .then(() => alert("âœ… Links copied!"));
    }

    // ðŸ—‘ BULK DELETE
    function deleteSelected() {
      const selected = [...document.querySelectorAll(".rowCheckbox:checked")];

      if (selected.length === 0) return alert("No forms selected.");
      if (!confirm("Delete all selected forms?")) return;

      selected.forEach(cb => {
        db.collection("forms").doc(cb.dataset.id).delete()
          .then(() => cb.closest("tr").remove());
      });

      alert("âœ… Selected forms deleted!");
    }

    loadLinks();
  </script>
</body>
</html>
