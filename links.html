<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Links</title>
  <style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; }
    table { width: 100%; background: white; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    th { background: #eee; }
    a { color: blue; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .actions { margin: 10px 0; }
    .actions button {
      padding: 8px 12px;
      margin-right: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .actions button:hover { opacity: 0.85; }
    .delete-btn { background: red; color: white; }
    .copy-btn { background: #007bff; color: white; }
    .small-btn {
      font-size: 12px;
      padding: 4px 8px;
    }
  </style>
</head>
<body>
  <h2>ðŸ”— Saved Links</h2>

  <div class="actions">
    <button onclick="copySelected()" class="copy-btn">ðŸ“‹ Copy Selected Links</button>
    <button onclick="deleteSelected()" class="delete-btn">ðŸ—‘ Delete Selected Forms</button>
  </div>

  <table>
    <thead>
      <tr>
        <th><input type="checkbox" id="selectAll"></th>
        <th>Form Link</th>
        <th>Single Actions</th>
      </tr>
    </thead>
    <tbody id="linksTable"></tbody>
  </table>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
      authDomain: "usahackersland.firebaseapp.com",
      projectId: "usahackersland",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const table = document.getElementById("linksTable");
    const selectAllBox = document.getElementById("selectAll");

    selectAllBox.addEventListener("change", () => {
      document.querySelectorAll(".rowCheckbox").forEach(cb => cb.checked = selectAllBox.checked);
    });

    function loadLinks() {
      db.collection("forms").orderBy("createdAt", "desc").get().then(snapshot => {
        table.innerHTML = "";
        snapshot.forEach(doc => {
          const id = doc.id;
          const link = `${location.origin}/Social-media-links/form.html?id=${id}`; // âœ… Correct path
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td><input type="checkbox" class="rowCheckbox" data-id="${id}" data-link="${link}"></td>
            <td><a href="${link}" target="_blank">${link}</a></td>
            <td>
              <button class="copy-btn small-btn" onclick="copyLink('${link}')">ðŸ“‹ Copy</button>
              <button class="delete-btn small-btn" onclick="deleteForm('${id}', this)">ðŸ—‘ Delete</button>
            </td>
          `;
          table.appendChild(tr);
        });
      });
    }

    function copyLink(link) {
      navigator.clipboard.writeText(link)
        .then(() => alert("âœ… Link copied!"));
    }

    function deleteForm(id, btn) {
      if (!confirm("Are you sure you want to delete this form?")) return;
      db.collection("forms").doc(id).delete()
        .then(() => btn.closest("tr").remove());
    }

    function copySelected() {
      const selectedLinks = Array.from(document.querySelectorAll(".rowCheckbox:checked"))
        .map(cb => cb.dataset.link);
      if (selectedLinks.length === 0) return alert("No links selected.");
      navigator.clipboard.writeText(selectedLinks.join("\n"))
        .then(() => alert("âœ… Links copied to clipboard!"));
    }

    function deleteSelected() {
      const selectedBoxes = Array.from(document.querySelectorAll(".rowCheckbox:checked"));
      if (selectedBoxes.length === 0) return alert("No forms selected.");
      if (!confirm("Are you sure you want to delete selected forms?")) return;

      selectedBoxes.forEach(cb => {
        db.collection("forms").doc(cb.dataset.id).delete()
          .then(() => cb.closest("tr").remove());
      });
      alert("âœ… Selected forms deleted!");
    }

    loadLinks();
  </script>
</body>
</html>
