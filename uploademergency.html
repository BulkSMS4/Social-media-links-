<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Upload Emergency Files â€” Admin</title>
<style>
body { font-family: Arial,sans-serif; background:#000; color:lime; padding:20px; }
h1 { color:#ff3333; text-align:center; }
.container { max-width:600px; margin:0 auto; background:#111; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.6); }
label { display:block; margin-top:12px; margin-bottom:6px; color:#adff2f; }
input, select, textarea, button { width:100%; padding:10px; border-radius:8px; border:1px solid lime; margin-bottom:12px; background:#000; color:lime; }
button { cursor:pointer; background:lime; color:black; font-weight:700; }
.progress-bar { width:0%; height:20px; background:lime; margin-bottom:12px; border-radius:8px; transition: width 0.3s; }
.note { font-size:13px; color:#adff2f; margin-bottom:12px; }
a.download-link { color:#1e90ff; text-decoration:none; font-weight:700; }
</style>
</head>
<body>

<h1>Upload Emergency Files</h1>
<div class="container">
  <label for="fileInput">Select File (APK, ZIP, RAR, PDF, HTML, Images)</label>
  <input type="file" id="fileInput" accept=".apk,.zip,.rar,.pdf,.html,image/*">

  <label for="fileName">File Name (Optional)</label>
  <input type="text" id="fileName" placeholder="Custom display name">

  <label for="fileDesc">Description (Optional)</label>
  <textarea id="fileDesc" placeholder="Enter description or warning message"></textarea>

  <label for="fileColor">Text Color (Optional)</label>
  <input type="color" id="fileColor" value="#ff3333">

  <label for="fileBg">Background Color (Optional)</label>
  <input type="color" id="fileBg" value="#000000">

  <label for="fileSpeed">Ticker Scroll Speed (Seconds, default 12)</label>
  <input type="number" id="fileSpeed" placeholder="12">

  <div class="progress-bar" id="progressBar"></div>
  <button id="uploadBtn">Upload File</button>
  <div class="note" id="statusNote">Select a file to upload.</div>

  <h3>Uploaded Emergency Files:</h3>
  <div id="uploadedFiles"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey:"AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
  authDomain:"usahackersland.firebaseapp.com",
  projectId:"usahackersland",
  storageBucket:"usahackersland.appspot.com",
  messagingSenderId:"588407428267",
  appId:"1:588407428267:web:7c4898cbb62efd3d5953ee"
};
if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

const fileInput = document.getElementById('fileInput');
const fileNameInput = document.getElementById('fileName');
const fileDescInput = document.getElementById('fileDesc');
const fileColorInput = document.getElementById('fileColor');
const fileBgInput = document.getElementById('fileBg');
const fileSpeedInput = document.getElementById('fileSpeed');
const uploadBtn = document.getElementById('uploadBtn');
const progressBar = document.getElementById('progressBar');
const statusNote = document.getElementById('statusNote');
const uploadedFilesDiv = document.getElementById('uploadedFiles');

// Upload file
uploadBtn.addEventListener('click', () => {
  const file = fileInput.files[0];
  if(!file) return alert('Please select a file!');
  
  const displayName = fileNameInput.value || file.name;
  const description = fileDescInput.value || '';
  const color = fileColorInput.value || '#ff3333';
  const bgColor = fileBgInput.value || '#000';
  const speedSec = Number(fileSpeedInput.value) || 12;

  const storageRef = storage.ref('emergencyFiles/' + Date.now() + '-' + file.name);
  const uploadTask = storageRef.put(file);

  uploadTask.on('state_changed',
    snapshot => {
      const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
      progressBar.style.width = progress + '%';
      statusNote.textContent = `Uploading: ${Math.round(progress)}%`;
    },
    error => { statusNote.textContent = 'Upload failed: ' + error; },
    () => {
      uploadTask.snapshot.ref.getDownloadURL().then(url => {
        // Save metadata in Firestore
        db.collection('emergencyFiles').add({
          name: displayName,
          url: url,
          type: file.type,
          description: description,
          color: color,
          bgColor: bgColor,
          speedSec: speedSec,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        }).then(()=>{
          statusNote.textContent = 'File uploaded successfully!';
          progressBar.style.width = '0%';
          fileInput.value = '';
          fileNameInput.value = '';
          fileDescInput.value = '';
          loadUploadedFiles();
        });
      });
    }
  );
});

// Load uploaded files
function loadUploadedFiles() {
  uploadedFilesDiv.innerHTML = 'Loading...';
  db.collection('emergencyFiles').orderBy('createdAt','desc').get().then(snapshot=>{
    uploadedFilesDiv.innerHTML = '';
    snapshot.forEach(doc=>{
      const data = doc.data();
      const div = document.createElement('div');
      div.innerHTML = `<a class="download-link" href="${data.url}" target="_blank">${data.name}</a> - <span style="color:${data.color}">${data.description || ''}</span>`;
      uploadedFilesDiv.appendChild(div);
    });
  });
}

// Initial load
loadUploadedFiles();
</script>

</body>
</html>
