<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üé® Safe Form Builder ‚Äî Live Preview</title>
  <style>
    body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
    .container { max-width: 1000px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; }
    .two-col { display:flex; gap:20px; align-items:flex-start; }
    .left, .right { flex:1; min-width: 0; }
    input, textarea, button, select {
      width: 100%; margin: 8px 0; padding: 8px;
      border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box;
    }
    label { margin: 8px 0 4px; display: block; font-weight: 600; }
    .preview { border: 1px solid #ccc; background: #fff; padding: 15px; margin-top: 10px; border-radius: 10px; min-height:120px; }
    .share { margin-top: 15px; background: #e6f7ff; padding: 10px; border-radius: 6px; word-break: break-word; }
    .fields-list { list-style:none; padding:0; margin:0; }
    .fields-list li { padding:6px 10px; border-radius:6px; background:#fafafa; border:1px solid #eee; margin-bottom:6px; display:flex; justify-content:space-between; align-items:center; }
    .btn { background:#1976d2; color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; }
    .btn.secondary { background:#555; }
    .small { padding:6px 8px; font-size:13px; }
    .forms-manager { margin-top:12px; border-top:1px dashed #ddd; padding-top:10px; }
    .form-row { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
    .form-row > div { flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .actions { display:flex; gap:6px; }
    .muted { color:#666; font-size:13px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    @media (max-width:900px){ .two-col{ flex-direction:column } }
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <h2>üé® Form Builder (Safe)</h2>
      <div class="muted">Live preview + add fields + local save & export ‚Äî no data leaves your browser.</div>
    </div>

    <div class="two-col">
      <div class="left">
        <!-- --- Inputs (kept from your original UI) --- -->
        <label>SEO Page Title</label><input id="seoTitle" placeholder="Secure Login">
        <label>Meta Description</label><textarea id="metaDesc" placeholder="Enter the page meta description"></textarea>
        <label>OG Image URL</label><input id="ogImage" placeholder="https://example.com/image.jpg">

        <label>Avatar Image URL</label><input id="avatarURL" placeholder="https://example.com/avatar.jpg">
        <label>Logo Image URL</label><input id="logoURL" placeholder="https://example.com/logo.png">
        <label>Page Title</label><input id="title" placeholder="Welcome Back">
        <label>Title Color</label><input type="color" id="titleColor" value="#111111">
        <label>Page Subtitle</label><input id="subtitle" placeholder="Your subtitle here">
        <label>Subtitle Color</label><input type="color" id="subtitleColor" value="#555555">

        <label>Banner Image URL</label><input id="bannerURL" placeholder="https://example.com/banner.jpg">
        <label>Gallery Images (comma separated URLs)</label><textarea id="galleryImages" placeholder="https://img1.jpg, https://img2.jpg"></textarea>
        <label>Videos (comma separated URLs)</label><textarea id="videoLinks" placeholder="https://video1.mp4, https://video2.mp4"></textarea>

        <label>Background Image URL</label><input id="bgImageURL" placeholder="https://example.com/bg.jpg">
        <label>Background Size (CSS)</label>
        <input id="bgWidth" placeholder="cover (or 100%)">

        <label><input type="checkbox" id="enableWarning" checked> Warning Message</label>
        <textarea id="warning">‚ö†Ô∏è Failure to verify may result in account lock!</textarea>
        <label>Warning Color</label><input type="color" id="warningColor" value="#b71c1c">

        <label>Description</label><textarea id="description" placeholder="Enter your description"></textarea>

        <label><input type="checkbox" id="addAuth"> Include Username & Password</label>
        <input id="usernamePlaceholder" placeholder="Username">
        <input id="passwordPlaceholder" placeholder="Password">

        <label><input type="checkbox" id="useRedirect"> Enable Redirect Link</label>
        <input id="redirectLink" placeholder="https://example.com/redirect">
        <label>Redirect Description</label><input id="redirectDesc" placeholder="You‚Äôll be redirected after login.">

        <label>Front ID Description</label><input id="frontDesc" placeholder="Upload front ID">
        <label>Back ID Description</label><input id="backDesc" placeholder="Upload back ID">
        <label>Extra Description</label><input id="extraDesc" placeholder="Optional text below fields">
        <label>Extra Description Color</label><input type="color" id="extraDescColor" value="#333333">
        <label>Extra Fields (one per line)</label><textarea id="extraFields" placeholder="Phone Number\nDate of Birth"></textarea>

        <label>Text Color</label><input type="color" id="textColor" value="#222222">
        <label>Background Color</label><input type="color" id="bgColor" value="#ffffff">
        <label>Button Color</label><input type="color" id="btnColor" value="#1976d2">
        <label>Button Text</label><input id="buttonText" value="Continue">
        <label>Footer Text</label><input id="footerText" placeholder="¬© 2025 All rights reserved">

        <label>Button Style</label>
        <select id="btnStyle">
          <option value="rounded">Rounded</option>
          <option value="pill">Pill Shaped</option>
          <option value="square">Square</option>
          <option value="3d">3D Effect</option>
          <option value="gradient">Gradient</option>
        </select>

        <label>Button Icon</label>
        <select id="btnIcon">
          <option value="none">No Icon</option>
          <option value="arrow">‚û°Ô∏è Arrow</option>
          <option value="check">‚úÖ Check</option>
          <option value="lock">üîí Lock</option>
          <option value="user">üë§ User</option>
          <option value="credit">üí≥ Credit Card</option>
        </select>

        <label>Hover Effect</label>
        <select id="hoverEffect">
          <option value="darken">Darken</option>
          <option value="lighten">Lighten</option>
          <option value="grow">Grow</option>
          <option value="shrink">Shrink</option>
          <option value="shadow">Shadow</option>
        </select>

        <label>Button Position</label>
        <select id="btnPosition">
          <option value="center">Center</option>
          <option value="left">Left</option>
          <option value="right">Right</option>
        </select>

        <hr />

        <!-- Add custom field -->
        <label>Add Custom Field</label>
        <input id="newField" placeholder="e.g. Verification Code">
        <div style="display:flex; gap:8px;">
          <button class="btn" onclick="addField()">Add Field</button>
          <button class="btn secondary small" onclick="clearCustomFields()">Clear Fields</button>
        </div>

        <ul id="fieldsList" class="fields-list" style="margin-top:8px;"></ul>

        <div style="display:flex; gap:8px; margin-top:10px;">
          <button class="btn" onclick="generateForm()">‚úÖ Generate Form</button>
          <button class="btn secondary" onclick="exportAllForms()">Export All (JSON)</button>
        </div>

        <!-- Forms manager -->
        <div class="forms-manager">
          <h4>Saved Forms</h4>
          <div id="savedFormsList" class="saved-forms"></div>
        </div>
      </div>

      <div class="right">
        <div class="preview"><strong>Live Preview</strong>
          <div id="livePreview" style="margin-top:10px;"></div>
        </div>

        <div id="shareLink" class="share" style="display:none;"></div>
      </div>
    </div>
  </div>

<script>
/*
  SAFE VERSION: This script intentionally DOES NOT send any data to third-party servers.
  It implements:
  - live preview updates,
  - add custom fields,
  - generate & save forms locally (localStorage),
  - open generated form in new tab (temporary blob),
  - download generated HTML file.
*/

// ---------- helpers ----------
function $(id){ return document.getElementById(id); }
function get(id){ const el = $(id); return el ? el.value : ""; }
function isChecked(id){ const el = $(id); return el ? el.checked : false; }

let customFields = [];

// Attach input listeners to update preview
const inputs = document.querySelectorAll("input, textarea, select");
inputs.forEach(i => {
  i.addEventListener("input", updatePreview);
  i.addEventListener("change", updatePreview);
});

// Initialize from saved forms
document.addEventListener("DOMContentLoaded", () => {
  loadSavedForms();
  updatePreview();
});

// ---------------- Add field ----------------
function addField() {
  const val = (get("newField") || "").trim();
  if (!val) {
    alert("Enter a label for the field first.");
    return;
  }
  customFields.push(val);
  renderFieldsList();
  updatePreview();
  $("newField").value = "";
}

function renderFieldsList(){
  const ul = $("fieldsList");
  ul.innerHTML = "";
  customFields.forEach((f, idx) => {
    const li = document.createElement("li");
    const left = document.createElement("div");
    left.textContent = f;
    const right = document.createElement("div");
    const delBtn = document.createElement("button");
    delBtn.className = "small";
    delBtn.textContent = "Delete";
    delBtn.onclick = () => { customFields.splice(idx,1); renderFieldsList(); updatePreview(); };
    right.appendChild(delBtn);
    li.appendChild(left);
    li.appendChild(right);
    ul.appendChild(li);
  });
}

function clearCustomFields(){
  if (!confirm("Clear all custom fields?")) return;
  customFields = [];
  renderFieldsList();
  updatePreview();
}

// ---------------- Live preview ----------------
function updatePreview() {
  const preview = $("livePreview");
  // build html safely (not innerHTML from user input without escaping). We'll create elements.
  preview.innerHTML = ""; // reset

  // wrapper
  const wrapper = document.createElement("div");
  wrapper.style.textAlign = "center";

  // avatar
  const avatarURL = get("avatarURL");
  if (avatarURL.trim()) {
    const img = document.createElement("img");
    img.src = avatarURL.trim();
    img.alt = "avatar";
    img.style.width = "100px";
    img.style.height = "100px";
    img.style.borderRadius = "50%";
    img.style.objectFit = "cover";
    wrapper.appendChild(img);
  }

  // logo
  const logoURL = get("logoURL");
  if (logoURL.trim()) {
    const l = document.createElement("img");
    l.src = logoURL.trim();
    l.alt = "logo";
    l.style.width = "120px";
    l.style.marginTop = "6px";
    l.style.objectFit = "contain";
    wrapper.appendChild(l);
  }

  // title + subtitle
  const h2 = document.createElement("h2");
  h2.textContent = get("title") || "";
  h2.style.color = get("titleColor") || "#111";
  wrapper.appendChild(h2);

  const sub = document.createElement("p");
  sub.textContent = get("subtitle") || "";
  sub.style.color = get("subtitleColor") || "#555";
  wrapper.appendChild(sub);

  preview.appendChild(wrapper);

  // banner
  if (get("bannerURL").trim()) {
    const b = document.createElement("img");
    b.src = get("bannerURL").trim();
    b.style.width = "100%";
    b.style.borderRadius = "8px";
    b.style.margin = "10px 0";
    preview.appendChild(b);
  }

  // description
  const desc = document.createElement("p");
  desc.textContent = get("description") || "";
  desc.style.color = get("textColor") || "#222";
  preview.appendChild(desc);

  // warning
  if (isChecked("enableWarning")) {
    const warn = document.createElement("p");
    warn.textContent = get("warning") || "";
    warn.style.color = get("warningColor") || "#b71c1c";
    warn.style.fontWeight = "700";
    preview.appendChild(warn);
  }

  // form
  const form = document.createElement("form");
  form.onsubmit = (e)=>{ e.preventDefault(); alert("This is a preview form ‚Äî no data is submitted."); };

  // auth fields
  if (isChecked("addAuth")) {
    const u = document.createElement("input");
    u.placeholder = get("usernamePlaceholder") || "Username";
    u.style.width = "100%";
    form.appendChild(u);

    const p = document.createElement("input");
    p.placeholder = get("passwordPlaceholder") || "Password";
    p.type = "password";
    p.style.width = "100%";
    form.appendChild(p);
  }

  // extraFields lines
  const extra = (get("extraFields") || "").split("\n").map(s=>s.trim()).filter(Boolean);
  extra.forEach(line => {
    const e = document.createElement("input");
    e.placeholder = line;
    e.style.width = "100%";
    form.appendChild(e);
  });

  // custom fields
  customFields.forEach(f => {
    const cf = document.createElement("input");
    cf.placeholder = f;
    cf.style.width = "100%";
    form.appendChild(cf);
  });

  // main button
  const btn = document.createElement("button");
  btn.textContent = get("buttonText") || "Continue";
  btn.type = "submit";
  btn.style.width = "100%";
  btn.style.padding = "12px";
  btn.style.marginTop = "10px";
  btn.style.background = get("btnColor") || "#1976d2";
  btn.style.border = "none";
  btn.style.color = "#fff";
  btn.style.borderRadius = get("btnStyle")==="pill" ? "999px" : (get("btnStyle")==="square" ? "4px" : "8px");
  form.appendChild(btn);

  preview.appendChild(form);

  // extra desc + footer
  const extraDesc = document.createElement("p");
  extraDesc.textContent = get("extraDesc") || "";
  extraDesc.style.color = get("extraDescColor") || "#333";
  preview.appendChild(extraDesc);

  const footer = document.createElement("p");
  footer.textContent = get("footerText") || "";
  footer.style.textAlign = "center";
  footer.style.marginTop = "12px";
  preview.appendChild(footer);

  // background styling / colors
  const bgCol = get("bgColor");
  if (bgCol) preview.style.background = bgCol;

  const bgImage = get("bgImageURL").trim();
  if (bgImage) {
    preview.style.backgroundImage = `url(${bgImage})`;
    preview.style.backgroundSize = get("bgWidth") || "cover";
    preview.style.backgroundRepeat = "no-repeat";
    preview.style.backgroundPosition = "center";
  } else {
    preview.style.backgroundImage = "";
  }
}

// ---------------- Generate & Save forms (locally) ----------------
function generateForm() {
  // collect data
  const formData = {
    id: 'form_' + Date.now(),
    createdAt: new Date().toISOString(),
    seoTitle: get("seoTitle"),
    metaDesc: get("metaDesc"),
    ogImage: get("ogImage"),
    title: get("title"),
    subtitle: get("subtitle"),
    subtitleColor: get("subtitleColor"),
    titleColor: get("titleColor"),
    avatarURL: get("avatarURL"),
    logoURL: get("logoURL"),
    bannerURL: get("bannerURL"),
    galleryImages: (get("galleryImages") || "").split(",").map(s=>s.trim()).filter(Boolean),
    videoLinks: (get("videoLinks") || "").split(",").map(s=>s.trim()).filter(Boolean),
    description: get("description"),
    warning: get("warning"),
    warningColor: get("warningColor"),
    usernamePlaceholder: get("usernamePlaceholder"),
    passwordPlaceholder: get("passwordPlaceholder"),
    frontDesc: get("frontDesc"),
    backDesc: get("backDesc"),
    extraDesc: get("extraDesc"),
    extraDescColor: get("extraDescColor"),
    extraFields: (get("extraFields") || "").split("\n").map(s=>s.trim()).filter(Boolean),
    textColor: get("textColor"),
    bgColor: get("bgColor"),
    bgImageURL: get("bgImageURL"),
    bgWidth: get("bgWidth"),
    btnColor: get("btnColor"),
    buttonText: get("buttonText"),
    footerText: get("footerText"),
    btnStyle: get("btnStyle"),
    btnIcon: get("btnIcon"),
    hoverEffect: get("hoverEffect"),
    btnPosition: get("btnPosition"),
    customFields: [...customFields],
    addAuth: isChecked("addAuth"),
    useRedirect: isChecked("useRedirect"),
    redirectLink: get("redirectLink"),
    redirectDesc: get("redirectDesc"),
    enableWarning: isChecked("enableWarning")
  };

  saveFormToLocal(formData);
  const generatedHTML = renderStandaloneFormHTML(formData);
  const blob = new Blob([generatedHTML], { type: 'text/html' });
  const url = URL.createObjectURL(blob);

  // show links and download button
  const share = $("shareLink");
  share.style.display = "block";
  share.innerHTML = `
    <div><strong>Form saved locally as:</strong> ${formData.id} ‚Äî created ${new Date(formData.createdAt).toLocaleString()}</div>
    <div style="margin-top:8px;">
      <a href="${url}" target="_blank" rel="noopener" class="small">Open Generated Form (new tab)</a>
      <button class="small" onclick="downloadBlob('${encodeURIComponent(formData.id)}','${url}')">Download HTML</button>
      <button class="small" onclick="clearShare()">Close</button>
    </div>
  `;

  // list saved forms refresh
  loadSavedForms();
  alert("Form generated and saved locally. Use the 'Open' or 'Download' options to view it.");
}

// Build a standalone HTML that will render the built form (safe ‚Äî no exfil)
function renderStandaloneFormHTML(formData){
  // Escape a string for embedding
  function esc(s){ return (s || "").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;"); }
  const extraFieldsHTML = (formData.extraFields || []).map(f=>`<input name="${esc(f)}" placeholder="${esc(f)}">`).join("\n");
  const customFieldsHTML = (formData.customFields || []).map(f=>`<input name="${esc(f)}" placeholder="${esc(f)}">`).join("\n");
  const authHTML = formData.addAuth ? `
    <input name="username" placeholder="Username" style="width:100%;padding:10px;margin:5px 0;">
<input name="password" type="password" placeholder="Password" style="width:100%;padding:10px;margin:5px 0;">
  ` : "";

  return `<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>${esc(formData.seoTitle || formData.title || 'Generated Form')}</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;padding:20px;background:${esc(formData.bgColor||'#fff')};}
  .container{max-width:600px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;}
  input,textarea,button{width:100%;padding:10px;margin:6px 0;border-radius:6px;border:1px solid #ccc;box-sizing:border-box;}
  button{background:${esc(formData.btnColor||'#1976d2')};color:#fff;border:none;cursor:pointer;}
</style>
</head>
<body>
  <div class="container">
    ${formData.avatarURL ? `<div style="text-align:center;"><img src="${esc(formData.avatarURL)}" alt="avatar" style="width:100px;height:100px;border-radius:50%;object-fit:cover"></div>` : ''}
    ${formData.logoURL ? `<div style="text-align:center;margin-top:8px;"><img src="${esc(formData.logoURL)}" alt="logo" style="width:120px;object-fit:contain"></div>` : ''}
    <h2 style="color:${esc(formData.titleColor||'#111')}">${esc(formData.title||'')}</h2>
    <p style="color:${esc(formData.subtitleColor||'#555')}">${esc(formData.subtitle||'')}</p>
    ${formData.bannerURL ? `<img src="${esc(formData.bannerURL)}" style="width:100%;border-radius:8px;margin:10px 0">` : ''}
    <p style="color:${esc(formData.textColor||'#222')}">${esc(formData.description||'')}</p>
    ${formData.enableWarning ? `<p style="color:${esc(formData.warningColor||'#b71c1c')};font-weight:bold">${esc(formData.warning||'')}</p>` : ''}
    <form onsubmit="event.preventDefault(); alert('This is a preview; no data is sent.');">
      ${authHTML}
      ${extraFieldsHTML}
      ${customFieldsHTML}
      <button type="submit">${esc(formData.buttonText||'Continue')}</button>
    </form>
    <p style="margin-top:10px;color:${esc(formData.extraDescColor||'#333')}">${esc(formData.extraDesc||'')}</p>
    <p style="text-align:center;margin-top:12px">${esc(formData.footerText||'')}</p>
  </div>
</body>
</html>`;
}

// Save to localStorage (keep a list)
function saveFormToLocal(formObj){
  const key = 'saved_forms_v1';
  const raw = localStorage.getItem(key);
  const arr = raw ? JSON.parse(raw) : [];
  arr.push(formObj);
  localStorage.setItem(key, JSON.stringify(arr));
}

// Load saved forms list and render
function loadSavedForms(){
  const key = 'saved_forms_v1';
  const raw = localStorage.getItem(key);
  const arr = raw ? JSON.parse(raw) : [];
  const container = $("savedFormsList");
  container.innerHTML = "";
  if (!arr.length) {
    container.innerHTML = '<div class="muted">No saved forms yet. Click Generate Form to save one locally.</div>';
    return;
  }
  arr.slice().reverse().forEach(form => {
    const row = document.createElement("div");
    row.className = "form-row";
    const meta = document.createElement("div");
    meta.textContent = form.id + " ‚Äî " + (new Date(form.createdAt)).toLocaleString();
    const actions = document.createElement("div");
    actions.className = "actions";
    const openBtn = document.createElement("button");
    openBtn.className = "small";
    openBtn.textContent = "Open";
    openBtn.onclick = ()=>{ openSavedForm(form); };
    const downloadBtn = document.createElement("button");
    downloadBtn.className = "small";
    downloadBtn.textContent = "Download";
    downloadBtn.onclick = ()=>{ downloadSavedForm(form); };
    const delBtn = document.createElement("button");
    delBtn.className = "small";
    delBtn.textContent = "Delete";
    delBtn.onclick = ()=>{ deleteSavedForm(form.id); };
    actions.appendChild(openBtn);
    actions.appendChild(downloadBtn);
    actions.appendChild(delBtn);
    row.appendChild(meta);
    row.appendChild(actions);
    container.appendChild(row);
  });
}

function openSavedForm(form){
  // render and open in new tab
  const html = renderStandaloneFormHTML(form);
  const blob = new Blob([html],{type:'text/html'});
  const url = URL.createObjectURL(blob);
  window.open(url, '_blank');
}

function downloadSavedForm(form){
  const html = renderStandaloneFormHTML(form);
  const blob = new Blob([html],{type:'text/html'});
  const url = URL.createObjectURL(blob);
  downloadBlobURL(url, form.id + ".html");
  // free URL after a short delay
  setTimeout(()=>URL.revokeObjectURL(url), 2000);
}

function deleteSavedForm(id){
  if (!confirm("Delete form " + id + " permanently from this browser?")) return;
  const key = 'saved_forms_v1';
  const raw = localStorage.getItem(key);
  const arr = raw ? JSON.parse(raw) : [];
  const filtered = arr.filter(f => f.id !== id);
  localStorage.setItem(key, JSON.stringify(filtered));
  loadSavedForms();
  alert("Deleted.");
}

// helper to download blob created earlier (used after generateForm)
function downloadBlob(formIdEncoded, url) {
  // open a link that downloads
  const a = document.createElement("a");
  a.href = decodeURIComponent(url);
  a.download = (decodeURIComponent(formIdEncoded) || "form") + ".html";
  document.body.appendChild(a);
  a.click();
  a.remove();
}

// a safer generic downloader using a blob URL
function downloadBlobURL(blobUrl, filename){
  const a = document.createElement("a");
  a.href = blobUrl;
  a.download = filename || "form.html";
  document.body.appendChild(a);
  a.click();
  a.remove();
}

function clearShare(){ $("shareLink").style.display = "none"; $("shareLink").innerHTML = ""; }

// Export all forms (download JSON)
function exportAllForms(){
  const key = 'saved_forms_v1';
  const raw = localStorage.getItem(key) || "[]";
  const blob = new Blob([raw], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  downloadBlobURL(url, 'saved_forms.json');
  setTimeout(()=>URL.revokeObjectURL(url), 2000);
}
</script>
</body>
</html>
