<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Emergency Ticker</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
    }

    /* üåà Dynamic variables for color + speed */
    :root {
      --ticker-bg: linear-gradient(90deg, #8b0000, #b30000, #8b0000);
      --scroll-speed: 35s;
    }

    /* üö® Ticker bar */
    .ticker {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: var(--ticker-bg);
      color: #fff;
      padding: 10px 0;
      overflow: hidden;
      z-index: 9999;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .ticker.hidden {
      opacity: 0;
      transform: translateY(-100%);
      pointer-events: none;
    }

    .ticker-content {
      display: inline-block;
      white-space: nowrap;
      animation: scrollLeft var(--scroll-speed) linear infinite;
      font-size: 1.2rem;
      font-weight: bold;
      padding-left: 100%;
    }

    @keyframes scrollLeft {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    .ticker .icon {
      color: #ff4747;
      margin-right: 10px;
      animation: pulse 1.2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    main {
      margin-top: 80px;
      text-align: center;
      padding: 20px;
      color: lime;
    }

    /* ‚öôÔ∏è Admin control panel */
    .controls {
      background: #111;
      border: 1px solid lime;
      padding: 16px;
      border-radius: 10px;
      display: inline-block;
      margin-top: 20px;
    }

    label {
      color: lime;
      font-weight: bold;
      margin-right: 10px;
    }

    select, input[type=color] {
      background: #000;
      color: lime;
      border: 1px solid lime;
      border-radius: 6px;
      padding: 6px;
    }
  </style>
</head>
<body>

  <!-- üö® Emergency Ticker -->
  <div id="ticker" class="ticker hidden">
    <span class="ticker-content">
      <span class="icon">üö®</span>
      <span id="tickerText">Loading latest emergency message...</span>
    </span>
  </div>

  <!-- ‚öôÔ∏è Control panel for testing -->
  <main>
    <h2>Emergency Broadcast Control</h2>
    <p>Adjust how the emergency message moves and looks.</p>

    <div class="controls">
      <div>
        <label for="bgColor">üé® Background Color:</label>
        <input type="color" id="bgColor" value="#8b0000">
      </div>
      <div style="margin-top:10px;">
        <label for="speedSelect">‚ö° Scroll Speed:</label>
        <select id="speedSelect">
          <option value="15s">Faster</option>
          <option value="25s">Fast</option>
          <option value="35s" selected>Normal</option>
          <option value="50s">Slow</option>
          <option value="70s">Very Slow</option>
        </select>
      </div>
    </div>
  </main>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // üîë Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
      authDomain: "usahackersland.firebaseapp.com",
      projectId: "usahackersland",
      storageBucket: "usahackersland.appspot.com",
      messagingSenderId: "588407428267",
      appId: "1:588407428267:web:7c4898cbb62efd3d5953ee",
      measurementId: "G-ZJ05T7YNSQ"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const ticker = document.getElementById("ticker");
    const tickerText = document.getElementById("tickerText");
    const bgColorPicker = document.getElementById("bgColor");
    const speedSelect = document.getElementById("speedSelect");

    // üîÑ Load saved settings
    db.collection("settings").doc("ticker").get().then(doc => {
      if (doc.exists) {
        const data = doc.data();
        if (data.bgColor) {
          document.documentElement.style.setProperty("--ticker-bg", data.bgColor);
          bgColorPicker.value = data.bgColor;
        }
        if (data.speed) {
          document.documentElement.style.setProperty("--scroll-speed", data.speed);
          speedSelect.value = data.speed;
        }
      }
    });

    // üíæ Save settings on change
    bgColorPicker.addEventListener("input", async (e) => {
      const color = e.target.value;
      document.documentElement.style.setProperty("--ticker-bg", color);
      await db.collection("settings").doc("ticker").set({ bgColor: color }, { merge: true });
    });

    speedSelect.addEventListener("change", async (e) => {
      const speed = e.target.value;
      document.documentElement.style.setProperty("--scroll-speed", speed);
      await db.collection("settings").doc("ticker").set({ speed }, { merge: true });
    });

    // üì° Real-time listener for emergency posts
    db.collection("emergencyPosts")
      .orderBy("timestamp", "desc")
      .limit(5)
      .onSnapshot(snapshot => {
        if (!snapshot.empty) {
          const messages = snapshot.docs.map(doc => `üö® ${doc.data().text}`);
          tickerText.textContent = messages.join("   ‚∏ª   ");
          ticker.classList.remove("hidden");
        } else {
          ticker.classList.add("hidden");
        }
      });
  </script>
</body>
</html>
