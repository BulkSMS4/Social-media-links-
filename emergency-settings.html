<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ðŸš¨ Emergency Broadcast Settings â€” Admin Control</title>

<style>
  :root { --preview-height: 48px; }

  body {
    font-family: Arial, sans-serif;
    background: #0b0b0b;
    color: #e6ffe6;
    margin: 0;
    padding: 18px;
  }

  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 18px;
  }

  header h1 {
    color: #bfffbf;
    font-size: 20px;
    margin: 0;
  }

  .card {
    background: #111;
    border-radius: 10px;
    padding: 16px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
  }

  #previewWrap {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--preview-height);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    overflow: hidden;
  }

  #previewTicker {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    overflow: hidden;
  }

  #previewInner {
    white-space: nowrap;
    display: inline-block;
    padding-left: 100%;
    font-weight: bold;
    font-size: 16px;
  }

  @keyframes scroll-left {
    from { transform: translateX(0%); }
    to { transform: translateX(-100%); }
  }

  textarea, input, select {
    width: 100%;
    background: #050505;
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #dfffd8;
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 14px;
    box-sizing: border-box;
  }

  textarea { resize: vertical; min-height: 100px; }

  label {
    display: block;
    color: #bdf0bd;
    font-weight: bold;
    margin-bottom: 6px;
  }

  .row { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; }
  .col { flex: 1; min-width: 220px; }

  .btn {
    background: lime;
    color: black;
    padding: 10px 16px;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  .btn.secondary {
    background: transparent;
    color: #bdf0bd;
    border: 1px solid #2f2f2f;
  }

  .note { font-size: 13px; color: #9fd89f; margin-top: 6px; }

  @media (max-width: 720px) {
    body { padding: 10px; }
    header h1 { font-size: 18px; }
  }
</style>
</head>
<body>

<header>
  <h1>ðŸš¨ Emergency Broadcast Settings</h1>
  <div>Firestore: <strong>emergency/current</strong></div>
</header>

<!-- Live ticker preview -->
<div id="previewWrap">
  <div id="previewTicker">
    <div id="previewInner">Preview message</div>
  </div>
</div>

<main>
  <div class="card">
    <div>
      <label for="msgInput">Broadcast message</label>
      <textarea id="msgInput" placeholder="Type emergency broadcast message..."></textarea>
      <div class="note">If this message is blank, the broadcast bar will stay hidden.</div>
    </div>

    <div class="row">
      <div class="col">
        <label for="bgColor">Background Color</label>
        <input type="color" id="bgColor" value="#ffffff">
      </div>
      <div class="col">
        <label for="textColor">Text Color</label>
        <input type="color" id="textColor" value="#ff3333">
      </div>
      <div class="col">
        <label for="speedSelect">Scroll Speed</label>
        <select id="speedSelect">
          <option value="60">Very Slow</option>
          <option value="30">Slowly</option>
          <option value="18" selected>Slow</option>
          <option value="12">Normal</option>
          <option value="6">Fast</option>
          <option value="3">Faster</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label for="popupBgColor">Popup Border/Glow Color</label>
        <input type="color" id="popupBgColor" value="#ff3333">
      </div>
    </div>

    <div class="row">
      <button class="btn" id="btnPreview">Live Preview</button>
      <button class="btn" id="btnSave">Save Settings</button>
      <button class="btn secondary" id="btnReset">Reset</button>
    </div>

    <div class="note">
      Quick Speed:
      <button class="btn secondary" data-speed="60">Very Slow</button>
      <button class="btn secondary" data-speed="30">Slowly</button>
      <button class="btn secondary" data-speed="18">Slow</button>
      <button class="btn secondary" data-speed="12">Normal</button>
      <button class="btn secondary" data-speed="6">Fast</button>
      <button class="btn secondary" data-speed="3">Faster</button>
    </div>

    <p class="note">Last saved: <span id="lastSaved">Never</span></p>
  </div>
</main>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
    authDomain: "usahackersland.firebaseapp.com",
    projectId: "usahackersland",
    storageBucket: "usahackersland.appspot.com",
    messagingSenderId: "588407428267",
    appId: "1:588407428267:web:7c4898cbb62efd3d5953ee"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const msgInput = document.getElementById('msgInput');
  const bgColor = document.getElementById('bgColor');
  const textColor = document.getElementById('textColor');
  const popupBgColor = document.getElementById('popupBgColor');
  const speedSelect = document.getElementById('speedSelect');
  const previewWrap = document.getElementById('previewWrap');
  const previewInner = document.getElementById('previewInner');
  const btnPreview = document.getElementById('btnPreview');
  const btnSave = document.getElementById('btnSave');
  const btnReset = document.getElementById('btnReset');
  const lastSaved = document.getElementById('lastSaved');

  const docRef = db.collection('emergency').doc('current');

  const DEFAULTS = {
    text: '',
    color: '#ff3333',
    bgColor: '#ffffff',
    popupColor: '#ff3333',
    speedSec: 18
  };

  // Realtime listener
  docRef.onSnapshot(doc => {
    if (doc.exists) {
      const data = doc.data();
      msgInput.value = data.text || '';
      textColor.value = data.color || DEFAULTS.color;
      bgColor.value = data.bgColor || DEFAULTS.bgColor;
      popupBgColor.value = data.popupColor || DEFAULTS.popupColor;
      speedSelect.value = data.speedSec || DEFAULTS.speedSec;
      updatePreview();
      lastSaved.textContent = data.timestamp ? new Date(data.timestamp.toDate()).toLocaleString() : 'Saved';
    } else {
      updatePreview();
    }
  });

  function updatePreview() {
    const text = msgInput.value.trim();
    if (!text) {
      previewWrap.style.display = 'none';
      return;
    }
    previewWrap.style.display = 'flex';
    previewWrap.style.background = bgColor.value;
    previewInner.style.color = textColor.value;
    previewInner.textContent = text;
    const speed = Number(speedSelect.value || 18);
    previewInner.style.animation = `scroll-left ${speed}s linear infinite`;
  }

  btnPreview.addEventListener('click', updatePreview);

  btnSave.addEventListener('click', async () => {
    const data = {
      text: msgInput.value,
      color: textColor.value,
      bgColor: bgColor.value,
      popupColor: popupBgColor.value,
      speedSec: Number(speedSelect.value),
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    };
    await docRef.set(data, { merge: true });
    alert('âœ… Broadcast settings saved!');
  });

  btnReset.addEventListener('click', () => {
    if (!confirm('Reset to default settings?')) return;
    msgInput.value = '';
    textColor.value = DEFAULTS.color;
    bgColor.value = DEFAULTS.bgColor;
    popupBgColor.value = DEFAULTS.popupColor;
    speedSelect.value = DEFAULTS.speedSec;
    updatePreview();
  });

  document.querySelectorAll('[data-speed]').forEach(btn => {
    btn.addEventListener('click', () => {
      speedSelect.value = btn.dataset.speed;
      updatePreview();
    });
  });
</script>

</body>
</html>
