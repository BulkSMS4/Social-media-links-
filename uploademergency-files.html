<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Upload Emergency Files — Admin</title>
<style>
body { font-family: Arial,sans-serif; background:#000; color:lime; padding:20px; }
h1 { color:#ff3333; text-align:center; margin-bottom:20px; }
.container { max-width:700px; margin:0 auto; background:#111; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.6); }
label { display:block; margin-top:12px; margin-bottom:6px; color:#adff2f; font-weight:bold; }
input, select, textarea, button { width:100%; padding:10px; border-radius:8px; border:1px solid lime; margin-bottom:12px; background:#000; color:lime; box-sizing:border-box; }
button { cursor:pointer; background:lime; color:black; font-weight:700; }
.progress-bar { width:0%; height:20px; background:lime; margin-bottom:12px; border-radius:8px; transition: width 0.3s; }
.note { font-size:13px; color:#adff2f; margin-bottom:12px; }
.post { background:#0b0b0b; border-radius:12px; padding:10px; margin-bottom:10px; color:#fff; box-shadow:0 4px 10px rgba(0,0,0,0.6); }
.post .meta { font-size:12px; color:#9fd89f; margin-bottom:6px; display:flex; justify-content:space-between; gap:8px; align-items:center; }
.post a.download, .post a.install { display:inline-block; margin:4px 6px 4px 0; padding:6px 12px; border-radius:6px; background:#28a745; color:#fff; text-decoration:none; font-weight:700; }
.mask-link-row { display:flex; gap:8px; margin-bottom:6px; align-items:center; }
.mask-link-row input { flex:1; margin-bottom:0; }
.mask-link-row input.color-picker { width:50px; padding:0; height:32px; }
.mask-link-row button { width:auto; padding:6px 10px; }
.preview-area { margin-top:12px; padding:12px; border:1px solid lime; border-radius:8px; background:#111; color:#fff; }
</style>
</head>
<body>

<h1>Upload Emergency Files</h1>
<div class="container">

  <label for="fileInput">Select File (APK, ZIP, RAR, PDF, HTML, Images)</label>
  <input type="file" id="fileInput" accept=".apk,.zip,.rar,.pdf,.html,image/*">

  <label for="fileName">File Name (Optional)</label>
  <input type="text" id="fileName" placeholder="Custom display name">
  <label for="fileNameColor">File Name Color</label>
  <input type="color" id="fileNameColor" value="#ff3333">

  <label>Custom Masked Links (one per line: URL | Masked Text)</label>
  <div id="maskedLinksContainer"></div>
  <button type="button" id="addMaskedLinkBtn">+ Add Masked Link</button>

  <label for="fileDesc">Description (Optional)</label>
  <textarea id="fileDesc" placeholder="Enter description or warning message"></textarea>

  <label for="fileBg">Post Background Color</label>
  <input type="color" id="fileBg" value="#000000">

  <label for="fileSpeed">Ticker Scroll Speed (Seconds, default 12)</label>
  <input type="number" id="fileSpeed" placeholder="12">

  <div class="progress-bar" id="progressBar"></div>
  <button id="previewBtn">Preview</button>
  <button id="uploadBtn">Upload File</button>
  <div class="note" id="statusNote">Select a file to upload.</div>

  <h3>Preview:</h3>
  <div id="previewArea" class="preview-area"></div>

  <h3>Uploaded Emergency Files:</h3>
  <div id="uploadedFiles"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey:"AIzaSyB5zWUvl64s6wAjjeXd0mCUyhMEdzg_MmM",
  authDomain:"usahackersland.firebaseapp.com",
  projectId:"usahackersland",
  storageBucket:"usahackersland.appspot.com",
  messagingSenderId:"588407428267",
  appId:"1:588407428267:web:7c4898cbb62efd3d5953ee"
};
if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

const fileInput = document.getElementById('fileInput');
const fileNameInput = document.getElementById('fileName');
const fileNameColor = document.getElementById('fileNameColor');
const fileDescInput = document.getElementById('fileDesc');
const fileBgInput = document.getElementById('fileBg');
const fileSpeedInput = document.getElementById('fileSpeed');
const uploadBtn = document.getElementById('uploadBtn');
const previewBtn = document.getElementById('previewBtn');
const progressBar = document.getElementById('progressBar');
const statusNote = document.getElementById('statusNote');
const uploadedFilesDiv = document.getElementById('uploadedFiles');
const previewArea = document.getElementById('previewArea');

const maskedLinksContainer = document.getElementById('maskedLinksContainer');
const addMaskedLinkBtn = document.getElementById('addMaskedLinkBtn');

function createMaskedLinkRow(url='', text='', color='#ff3333'){
  const row = document.createElement('div');
  row.className = 'mask-link-row';
  row.innerHTML = `
    <input type="text" class="maskUrl" placeholder="URL" value="${url}">
    <input type="text" class="maskText" placeholder="Masked Text" value="${text}">
    <input type="color" class="maskColor" value="${color}">
    <button type="button" class="deleteLinkBtn">Delete</button>
  `;
  row.querySelector('.deleteLinkBtn').addEventListener('click',()=>row.remove());
  maskedLinksContainer.appendChild(row);
}
addMaskedLinkBtn.addEventListener('click', ()=>createMaskedLinkRow());

previewBtn.addEventListener('click', ()=>{
  const file = fileInput.files[0];
  if(!file) return alert('Select a file for preview!');
  const name = fileNameInput.value || file.name;
  const nameColor = fileNameColor.value;
  const desc = fileDescInput.value;
  const bg = fileBgInput.value;

  let html = `<div class="post" style="border:2px solid ${nameColor}; background:${bg};">
  <div class="meta">Admin | ${new Date().toLocaleString()}</div>
  <strong style="color:${nameColor}">${name}</strong><br>`;
  if(desc) html += `<div style="color:${nameColor}; margin-top:6px;">${desc}</div>`;

  maskedLinksContainer.querySelectorAll('.mask-link-row').forEach(r=>{
    const url = r.querySelector('.maskUrl').value;
    const text = r.querySelector('.maskText').value;
    const color = r.querySelector('.maskColor').value;
    if(url && text) html += `<a href="${url}" target="_blank" style="color:${color};" class="download">⬇ ${text}</a>
                              <a href="${url}" target="_blank" style="color:${color}; background:green;" class="install">Install</a>`;
  });
  html += `</div>`;
  previewArea.innerHTML = html;
});

uploadBtn.addEventListener('click', ()=>{
  const file = fileInput.files[0];
  if(!file) return alert('Select a file to upload!');
  const name = fileNameInput.value || file.name;
  const nameColor = fileNameColor.value;
  const desc = fileDescInput.value;
  const bg = fileBgInput.value;

  const storageRef = storage.ref('emergencyFiles/'+Date.now()+'-'+file.name);
  const uploadTask = storageRef.put(file);

  uploadTask.on('state_changed', snapshot=>{
    const progress = (snapshot.bytesTransferred/snapshot.totalBytes)*100;
    progressBar.style.width = progress+'%';
    statusNote.textContent = `Uploading: ${Math.round(progress)}%`;
  }, error=>{
    statusNote.textContent = 'Upload failed: '+error;
  }, ()=>{
    uploadTask.snapshot.ref.getDownloadURL().then(url=>{
      const maskedLinks = [];
      maskedLinksContainer.querySelectorAll('.mask-link-row').forEach(r=>{
        const u = r.querySelector('.maskUrl').value;
        const t = r.querySelector('.maskText').value;
        const c = r.querySelector('.maskColor').value;
        if(u && t) maskedLinks.push({url:u,text:t,color:c});
      });
      db.collection('emergencyFiles').add({
        name, nameColor, desc, bg, url, maskedLinks,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      }).then(()=>{
        statusNote.textContent = 'File uploaded successfully!';
        progressBar.style.width='0%';
        fileInput.value=''; fileNameInput.value=''; fileDescInput.value='';
        maskedLinksContainer.innerHTML=''; previewArea.innerHTML='';
        loadUploadedFiles();
      });
    });
  });
});

function loadUploadedFiles(){
  uploadedFilesDiv.innerHTML='Loading...';
  db.collection('emergencyFiles').orderBy('createdAt','desc').get().then(snapshot=>{
    uploadedFilesDiv.innerHTML='';
    snapshot.forEach(doc=>{
      const data = doc.data();
      const div = document.createElement('div');
      div.className='post';
      div.innerHTML=`<strong style="color:${data.nameColor}">${data.name}</strong> - ${data.desc||''} 
      <a href="${data.url}" target="_blank" class="download">⬇ Download</a>`;
      data.maskedLinks.forEach(ml=>{
        div.innerHTML += ` <a href="${ml.url}" target="_blank" style="color:${ml.color};" class="download">⬇ ${ml.text}</a>`;
      });
      uploadedFilesDiv.appendChild(div);
    });
  });
}

// Initial load
loadUploadedFiles();
</script>

</body>
<html>
